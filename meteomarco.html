<html>
<head>
    <link rel='icon' type='image/ico”' href='https://lh3.googleusercontent.com/pw/ACtC-3efjJgaQUddJ_VcHyhOJG2rReAo2QYbyWFw7f8iueqxyqGuKZT8ub3k8d9Gk7iCrJaokmWOVRmmRzc8uKHlIEfO7oFFN0qxlv7Ki207U1kYCyEfEd92pzkcHWW38cl-rfXRb6yApcHkBa1uus1swscO=s150-no?authuser=0'>
    <title>Meteo Marco v 1.0</title>
    <link rel = "preconnect" href = "https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https: //fonts.googleapis.com/css2? family= Raleway & display=swap" rel="stylesheet">
<link href="https: //fonts.googleapis.com/css2? family= Source+Code+Pro:wght@300 & display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Oswald&display=swap" rel="stylesheet">
<link href="meteostile.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

      <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1EFHH3K88D"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

  gtag('config', 'UA-204455590-1');
gtag('config', 'G-1EFHH3K88D');
</script>

  </head>
  <body onload="iniziobody()">

    <div id="loading_screen">
      <center><h1>Caricamento...</h1>
        <h1 id='lo'></h1>
      <img src='https://lh3.googleusercontent.com/4C_-jJfQzD8FECrYDyvi34N8spXBHIr26IPH-9njn7dYmImreD3zfIFm-4bDSwxYJJrWFPgA3nCgGhHj82Q8orUE_Iqh2dpaYRqg14HGi_QRJZ03f8-MzgfGbDo0zxDbLXMRnKCxe1Z8s4x9c1Rg0m6MTqgS3wh70_fRa9BfiimsFXbKVuOb5x0i9SDOvm7qUZdkhEghP9wHXNi70knLwEh-1LiXGLNV2mSqd-wcamtpgNXfoHJB_Xr4Obn_zb7vqCke4pO7MF9lWMBkFz3vhncIsiBgdbmWytphchLc_I9Z9pE76tmFcyXazY8pSOcRdWSnxdR2rX67GddqbfcQQCLTEDgdLOP2K8zk1LGYfC3y_ZdRUI81TmP46zWTPRzl1CNuROo7sPkk6dV_wGorS1RN9f56qGz-gwuoNh6E1fIO_oHVO6HOuZ0oWldGFeZ-gZ9yn6Iacq2pqM7Vqxp--Bq_PT-uqHUwCxYlMTJ4YaU-oL8l-ZLIB5-jsFdfCvKD91PPNdZWC-Qm67EXbG5kg4_BiPN0EEDgtNz0Ob4JfEhXQPT40MO18e5lKS9D8wljuqi1Ir1XE_NBpuVxisiA3HdqKg4PXkLMgM0qj9Sy_y4aG-kzA26mN9wNXZSwK8CX27J7WfSxqNqBjHLDtTW0IX-hVovPWVIlntsF0UR-CAgS7FTAvw-aw5DgUbFpJbp2VN-pvAafKFUYC3OCcNETNDg=s400-no?authuser=0'></img>
    </center>
    </div>


    <div id='accessoc'>
      <span id='acc'></span>
    </div>
    <br><br><br><br><br><br><br>
    <center><img src='meteomarcologo.png' id='inizio'></img></center>

    <center><h1 id='textuno'>Accedi col tuo account Marco Express per visualizzare dati, prevsioni e altro ancora! Se hai gi&agrave; effettuato l'accesso in questo dispositivo senza disconnetterlo, attendi qualche istante....</h1>

    <br>

      <input type="text" placeholder="Email" id="email" onchange="checkEmail()"></input><br><p id="validaidmail"></p><br>
    <input type="password" placeholder="Password" id="password"/>
    <button id="button" type="button" onclick="showPwd()">


    <img src='https://lh3.googleusercontent.com/pw/ACtC-3fsiPnrtt4QsQITPf6bt7DuGpEJAp2jiVi9HDAMd9lfL2n_zRkioGhq3ON7kNKTkDYH0U-Cg1He3jzivqsRC87hgNx3bZoE9QOE4cnWiTqKElk_I5CvicwuHro24wXBohZhEmOWC5OTgUBiULJGhc55=s24-no?authuser=0' height='40px'></img>
  </button><br><br>
    <button onclick="signIn()" id="signIn"><h1><b>Login</b></h1></button><br><br>
    <button onclick='reimposta()' id='reiu'><h1>Password dimenticata? Reimpostala ora.</h1></button></center>

    <span id='display'></span>
    <button onclick='feed()' id='feed'><h2 id='fte'>Lascia un Feedback!</h2></button>
    <button onclick='due()' id='due'><h2 id='tdue'>Esegui una donazione!</h2></button>


<script>
(function(){
if (window.addEventListener)
{
window.addEventListener("load", nascondi_loading_screen, false);

}else{
window.attachEvent("onload", nascondi_loading_screen);
}
})();
function nascondi_loading_screen()
{
document.getElementById("loading_screen").style.display = 'none';
}



</script>

    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js" onload="document.getElementById('lo').innerHTML = 'Caricamento libreria Firebase app in corso...'"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-auth.js" onload="document.getElementById('lo').innerHTML = 'Caricamento libreria Firebase auth in corso...'"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-database.js" onload="document.getElementById('lo').innerHTML = 'Caricamento libreria Firebase DB in corso...'"></script>
     <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"onload="document.getElementById('lo').innerHTML = 'Caricamento libreria pdf creator in corso...'"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js" onload="document.getElementById('lo').innerHTML = 'Caricamento libreria jQuery in corso...'"></script>

    <script>
      var firebaseConfig = {
        apiKey: "AIzaSyCIw0-w1C3zDjoGgVpLKsFYm2TFXqJr9yw",
        authDomain: "marco-express-d30c8.firebaseapp.com",
        projectId: "marco-express-d30c8",
        storageBucket: "marco-express-d30c8.appspot.com",
        messagingSenderId: "764621319758",
        appId: "1:764621319758:web:9390a4a994df27cda4dd1f",
        measurementId: "G-3ZK6NW0G3F"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

     const auth = firebase.auth();

/*document.addEventListener('contextmenu', event => event.preventDefault(

      document.getElementById('display').innerHTML = "<div id='hh'><center><h1>EHI! NON CERCARE D'IMBROGLIARE!</h1><h2>Secondo la politica sul corretto utilizzo dei siti Marco Express, &egrave; severamente vietato l'utilizzo della console ai non autorizzati. <br> Abbiamo segnalato il fatto che tu hai provato a barare. Nonostante ci&ograve; potrebbe essere che tu l'abbia fatto involontariamente. <b>Ora sai che non devi farlo</b>. La prossima volta ricordati che, se ci proverai di nuovo, verrai bannato dal sito e non avrai pi&ugrave; la possibilit&agrave; di usufruire degli abbonamenti e dei servizi.<br><br><br><button onclick='prosegui()'><h1>Prosegui l'utilizzo del sito</h1></button></center></div>"

   ));*/

   var input = document.getElementById("password");

   input.addEventListener("keydown", function (e) {
   if (e.keyCode == 13) {
   signIn();
   }
   });

   function validaEmail(email) {

       var regexp = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
       return regexp.test(email);
   }

   function checkEmail(){
     risultato = document.getElementById("validaidmail");
     email = document.getElementById("email").value;
     risultato.innerHTML = "";
     if (validaEmail(email)) {
       console.log("ok")
     } else {
       risultato.innerHTML = "<p id='ntext'><span class='material-icons md-48' style='color: red;'>error_outline</span> Indirizzo email non valido</p>";
       risultato.style.color = 'red';
     }
   }

   function dark(){
     $('p').css('color','white');
     $('body').css('background','#363636');
     $('.dettglitext').css('color','black');
    $('h2').css('color','white');
    $("#inizio").attr("src","https://lh3.googleusercontent.com/pw/AM-JKLUoDeBgtZIjsa-nvJPfVNggNzh4INzye5hmOZO2Xjv9yV7lRbPG49NjejeObQKUtp5wYAQKssXUoTi15-05jnqjaves_nMT3MsVC5FoS-8NaLVmJB5BJO0Kj2mLM2QzeeyzDm2-C4w3fbzIhPZJQbxQ=s903-no?authuser=0");
    $('#pomet').css('color','black');
    $('#mattt').css('color','black');
    $('#descrivimattina').css('color','black');
    $('#descrivipomeriggio').css('color','black');
    setTimeout(dark, 1000)
   }
   function chiaro(){
     $('p').css('color','black');
     $('body').css('background','white');
     $('.dettglitext').css('color','black');
    $('h2').css('color','black');
    $("#inizio").attr("src","https://lh3.googleusercontent.com/pw/AM-JKLVZGFiK5reg51jGXRh0bgF08EDqu6FDCe_VGLSCW4G0QktLk4Y_ye-9DCntiMjRQEEDloWF7_Tozq5pbFHbMDCNWuOLgQud5SBURSMIb13JJNwxhax_WmLmAjMwEvzndJvRY6nOws3_yd3bw2nIKBRL=s903-no?authuser=0");
    $('#pomet').css('color','black');
    $('#mattt').css('color','black');
    $('#descrivimattina').css('color','black');
    $('#descrivipomeriggio').css('color','black');
   }


     function jj() {
       var ok = $("#feed")
       ok.animate({
         height: "80px",
         width: "80px"
       }, 900)
       document.getElementById('fte').innerHTML = '<img src="https://lh3.googleusercontent.com/pw/AM-JKLVbVOJs-bg9c5p-4RMYN1rU3WwYceo4sCH6vFdmujR1tz3xxcOHHNGecU4GVq8PFT8uDJ7hmTkmfHnxNOzGdLVcLT39HE-ptKkf0kkNM1SOgezDTYY5TyBPUPYkN4i0jXdn2yoAPrSNVdoS8N2o6S2z=s24-no?authuser=0" height= "39px" width="39px"></img>'
       $('#feed').css('border-radius', '40px');


       var ook = $("#due")
       ook.animate({
         height: "80px",
         width: "80px"
       }, 900, jjj)
       document.getElementById('tdue').innerHTML = '<img src="donazione.png" height= "39px" width="39px"></img>'
       $('#due').css('border-radius', '40px');
     }

     function jjj() {
        $('#due').animate({
          right: "100px"
        }, 750)
     }

     function iniziobody() {
       setTimeout(jj, 7000)
      controllaabb()
    }

    function feed() {
      location.href = 'https://docs.google.com/forms/d/e/1FAIpQLSdtuUKjayKMK4yypsgnN0ftwQNLXYO_SGX-yTO4ocf4reLPBA/viewform?usp=sf_link'
    }

    function due(){
      alert('Ora ti reindrizzeremo sulla pagina dei pagamenti. Cliccare "Nuova Spesa", selezionare "Donazione", scrivere l\'importo e cliccare nuovamente su "Acquista". Ti ringraziamo di cuore dell\'aiuto che ci darai donando una qualsiasi cifra. (Clicca su "ok" per continuare)')
      location.href = 'gestionepagamenti.html'

    }



     function reimposta() {
       document.title = "Reimposta nuova password";
       document.getElementById('display').innerHTML = '<center><input type="text" id="rei" placeholder="Inserisci email"></input><br><br><button onclick="inviaemail()" id="confi"><h1>Invia email</h1></button></center>'
       document.getElementById('display').innerHTML += '<center><h1 id="avviso"></h1></center>'
       document.getElementById("password").style.display="none";
       document.getElementById("email").style.display="none";
       document.getElementById("signIn").style.display="none";
       document.getElementById("button").style.display="none";
       document.getElementById("textuno").style.display="none";
       document.getElementById("reiu").style.display="none";
     }

     function inviaemail() {
       if(navigator.onLine){
       var auth = firebase.auth();
       var emailAddress = document.getElementById('rei').value

       auth.sendPasswordResetEmail(emailAddress).then(function() {
         console.log('vai')
         document.getElementById('avviso').innerHTML = 'EMAIL INVIATA'
         document.getElementById('avviso').innerHTML += '<br><br><button id="rlogin" onclick="rlogin()">Effettua nuovamente il login</button>'

       }).catch(function(error) {
         console.log('no')
         document.getElementById('avviso').innerHTML = 'ERRORE: EMAIL NON DISPONIBILE'
         document.getElementById('avviso').innerHTML += '<br><br><button id="rlogin" onclick="rlogin()">Effettua nuovamente il login</button>'

  });}else{
    document.getElementById('avviso').innerHTML = 'ERRORE: IMPOSSIBILE CONNETTERSI AL SERVER'
  }
     }

function rlogin() {
location.reload()

}

function vai() {
  console.log('vai')
}

   	function signIn(){
      if(navigator.onLine){
   		var email = document.getElementById("email");
   		var password = document.getElementById("password");
   		const promise = auth.signInWithEmailAndPassword(email.value, password.value);
   		promise.catch(e => alert('Combinazione utente/password errata'));

   	}else{
      document.getElementById('display').innerHTML = '<h1>Impossibile connetersi al server</h1>'
    }}


   	function signOut(){
   		auth.signOut();
   		alert("Disconnessione completata!");
      window.location.reload()

   	}

     auth.onAuthStateChanged(function(user){
        document.title = "Meteo Marco - Previsioni";
         var email = user.email;
         alert("Uttente attivo:" + " " + email);
         console.warn('Utente attivo.')


         var user = firebase.auth().currentUser;
         user.providerData.forEach(function (profile) {
           if(profile.photoURL != ' ') {
             console.log('Premium Plus')
             premiumplus()
           }else{
                 document.getElementById("password").style.display="none";
                 document.getElementById("email").style.display="none";
                 document.getElementById("signIn").style.display="none";
                 document.getElementById("button").style.display="none";
                 document.getElementById("textuno").style.display="none";
                 document.getElementById("reiu").style.display="none";
                 document.getElementById('display').innerHTML = "<center><h1>Non hai nessun abbonamento Meteo Marco attivo ora.<br> <h1>Per acquistare Meteo Marco Premium Plus, <a href='https://marco-express.github.io/marcoexpress.official.site.github.io/gestionepagamenti.html'>clicca qui</a> e accedi. Poi vai sulla sezione \"Nuova spesa\" e seleziona \"Meteo Marco Premium Plus\". </h1></center>"
                 document.getElementById('display').innerHTML += '<br><br><center><button onclick="signOut()" id="signOut"><h1>Logout</h1><img src="https://lh3.googleusercontent.com/pw/ACtC-3fxEqyRV4Kgd6Zq9ZYJSi8aBG4TOp5qqBYOGl7OnRZUogm68jgxH4UIwV2rIi1pIUDv62xzfK4Cwbj_xIQyKVdqMtGtecPJa3t36jMGNe4bS_7_5h8QrdJH6lMSlc-9vmqzvKUcR5tGcj7zNqJpY_la=s24-no?authuser=0" height="50px"></img></button></center>'
               }

        });


           })

           function selezionaabb() {
             document.getElementById('display').innerHTML = ""

          }


           function ppabbn(){
             var user = firebase.auth().currentUser;
             var datadue = new Date();
             orad = datadue.getHours();
             min = datadue.getMinutes();
             dataduen = datadue.getDate();
             mesed = datadue.getMonth();
             annodue = datadue.getFullYear();
             mesed++



             var aa = "Ha acquistato Premium Plus " +  dataduen + "/" + mesed + "/" + annodue  + " alle ore " + orad + ":" + min
             user.updateProfile({
               photoURL: "Meteo Marco Premium Plus"
             }).then(function() {
               firebase.database().ref("MMPPacqtt").push().set({
                   "sender": user.email,
                   "message": aa,
               });
               document.getElementById('display').innerHTML = '<h1>Grazie! Acquisto effettuato!<br>Aggiorna la pagina e accedi, potrai visualizzare le info destinate agli utenti PP.</h1>'

               return false;
             }).catch(function(error) {
               document.getElementById('display').innerHTML = '<h1>Si &egrave; verificato un\'errore, riprova tra qualche minuto</h1>'
          });
           }

       function premiumplus() {
         document.title = "Meteo Marco - Previsioni";
       console.log('PremiumPlus')
       document.getElementById("password").style.display="none";
       document.getElementById("email").style.display="none";
       document.getElementById("signIn").style.display="none";
       document.getElementById("button").style.display="none";
       document.getElementById("textuno").style.display="none";
       document.getElementById("reiu").style.display="none";
       controllaabb();
       messaggidaleggere();
       setTimeout(messaggidaleggere , 1000)
       if(window.innerWidth > 1000){
         console.log('Computer')
         document.getElementById("acc").innerHTML = "<button id='previsioni' onclick='previsionipp()'><h1>Previsioni</h1></button> <button id='dati' onclick='datipp()'><h1>Dati</h1></button>"
         document.getElementById("acc").innerHTML += "<button onclick='tuoacc()' id='tuoacc'><h1>Impostazioni</h1></button>"

       }else{
         document.getElementById("acc").innerHTML = "<button id='previsioni' onclick='previsionipp()'><h1>Previsioni</h1><img src='https://lh3.googleusercontent.com/pw/ACtC-3cLkionUiv3xtdP-4kmN-FG5QlhsM-42OvQmh9iTzMY6I741J5755CwlmsDLVVuVt0qA1fsrODz3LoDrma9BFr-EiUzGiDXOJp3IvtVhwhc3u6LWfZb3arU4DXOAqjNXScK5hn6LpLdOvULAzMexN13=s24-no?authuser=0' height='50px' id='pimg'></img></button> <button id='dati' onclick='datipp()'><h1>Dati</h1><img id='dimg'src='https://lh3.googleusercontent.com/pw/ACtC-3c9TuUjBRQbuGEAnY9mcbpqp9BcsfsFhnt1EjeGwbpICAhiJ6Hov-PnkzSnNv0aBravVxPomEu8HALbnkzeC6sXRirtzHCiQKd-CryzqzS3Uf2YGNj4c1sz6E1wuscNZaRWEobXs7qN9SZpwBRzIWwb=s24-no?authuser=0' height='50px' id='taimg'></img></button>"
         document.getElementById("acc").innerHTML += "<button onclick='comunita()' id='comunita'  style='width: 20%; height: 35%; background:#f7f254; letter-spacing: 2px; border-radius: 15px;box-shadow: 10px 10px 5px #dedede; border: 3px solid yellow;'><h1>Community</h1><span class='material-icons md-60'>forum</span></button>"
         document.getElementById("acc").innerHTML += "<button onclick='tuoacc()' id='tuoacc' style='width: 25%; height: 35%; background: #c7c8c9; letter-spacing: 2px; border-radius: 15px;box-shadow: 10px 10px 5px #dedede; border: 3px solid #939596;'><h1>Impostazioni</h1><span class='material-icons md-60'>tune</span></button>"

         console.log('Dispositivo mobile')
       }


        document.getElementById("display").innerHTML = "<center><h2>Caricamento delle previsioni...</h2></center>"
        document.getElementById("display").innerHTML += "<center><h3>Connessione al server...</h3></center>"
        document.getElementById("display").innerHTML += "<center><br><img width='150px' src='https://lh3.googleusercontent.com/pw/ACtC-3cqK5HaPD1DJzuJsNl1G2Pa-1hWvH87lpVYGv2BL5Wz8rpuBN4f-L9lTwFVE0VdgL5FjpEumgkfOMAyutTQu2--Sjd_5xfj1ir-qLu3EKoqsZb-WJS5N3SH21wUyd2e1MoQW6YjVkh0IgFfuYrmTt8R=w64-h22-no?authuser=0'></img></center>"
        verificaprevisioni = setTimeout(noprevisioni, 10000)

         firebase.database().ref("Meteo Marco Premium Plus").on("child_added", function (snapshot) {
           var testo = snapshot.val().message;
           var titolo = snapshot.val().sender;
           var disp = document.getElementById('display')
           disp.innerHTML = '<p id="ttext" class="anime"><img id="simboloo"style="float:left; width: 100px; padding: 15px;" src="imgnot.png"></img>' + titolo + '<button onclick="aggiornaprevisioni()" id="aggprevisioni"><span class="material-icons md-48" id="aggiornato">update</span><span class="material-icons md-48" id="aggiornato2"></span></button></p>' + '<hr align="left" size="1" width="750" color="#919191" noshade><button onclick="ascolta()" id="ascolta"><img src="https://lh3.googleusercontent.com/pw/ACtC-3fUB_LXWYYOOLYD8sp07_c1AVbIbD4yuQ4lSuf0fqeLNxWIZTRq_1oMp4vOty24HL7A_4gTZqwZpWLljZzpcvtRh3Z9URrxzfgqnA67oxSP5JJu5cAZF1A2gsuVWhwD1uXY6BIOS2FnvL28onR7hEPc=s48-no?authuser=0"></img></button>' + '<p id="ntext" class="anime">' + testo + '</p><br></div>'
           disp.innerHTML += '<div class="dettaglipre" id="matt" style="float: left;"><img id="mattinaa"style="float: left;"></img><center><p id="mattt">Mattina</p></center><br><p class="dettore" id="descrivimattina"></p></div><div id="pomeriggio"><img id="pomeriggioo" style="float: left;"></img><center><p id="pomet" class="cambia">Pomeriggio</p></center><br><p class="dettore" id="descrivipomeriggio"></p></div></div>'
            clearTimeout(verificaprevisioni);
           var matt = $("#mattinaa")
           matt.attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
          $("#pomeriggioo").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
           setTimeout(animatutto , 1000)
     })

firebase.database().ref("Pom").on("child_added", function (snapshot) {
      var descrivi = snapshot.val().message;
  var logo = snapshot.val().sender;
  if(logo === "Soleggiato"){
    console.log('Soleggiatoooo!')
    $("#pomeriggioo").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
   document.getElementById('pomeriggio').style.backgroundImage = "url(https://laprovinciadibiella.it/wp-content/uploads/2020/04/meteo-soleggiato.jpg)";
  }else if(logo === "Parzialmente soleggiato"){
    document.getElementById('pomeriggio').style.backgroundImage = "url(https://script.meteolive.it/admin/immaginiNotizie/SRC/__070003___parziale.jpg)";
    $("#pomeriggioo").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
    document.getElementById('descrivipomeriggio').style.background = "#8fffea"
  }else if(logo === "Piovoso"){
    document.getElementById('pomeriggio').style.backgroundImage = "url(https://trani.news24.city/wp-content/uploads/sites/14/2019/04/PIOGGIA-MALTEMPO-METEO.jpg)";
      document.getElementById('descrivipomeriggio').style.color = "white"
      document.getElementById('pomet').style.color = "white"
    $("#pomeriggioo").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
  }else if(logo === "Temporali"){
    document.getElementById('pomeriggio').style.backgroundImage = "url(https://www.malpensa24.it/wp-content/uploads/2020/08/temporali-grandine-calo-termico.jpg)";
    $("#pomeriggioo").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
document.getElementById('descrivipomeriggio').style.background = "#141C2F"
document.getElementById('descrivipomeriggio').style.color = "white"
  }else if(logo === "Nuvoloso"){
    document.getElementById('pomeriggio').style.backgroundImage = "url(https://www.malpensa24.it/wp-content/uploads/2018/11/nuvole-cielo-coperto.jpg)";
    $("#pomeriggioo").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png")
    document.getElementById('pomet').style.color = "white"
    document.getElementById('descrivipomeriggio').style.color = "white"
    document.getElementById('descrivipomeriggio').style.background = "#626363"

  }
  document.getElementById('descrivipomeriggio').innerHTML = descrivi
  setTimeout(animatutto , 1000)
})

firebase.database().ref("Matt").on("child_added", function (snapshot) {
      var descrivi = snapshot.val().message;
  var logo = snapshot.val().sender;
  if(logo === "Soleggiato"){
    console.log('Soleggiatoooo!')
    $("#mattinaa").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
    document.getElementById('matt').style.backgroundImage = "url(https://laprovinciadibiella.it/wp-content/uploads/2020/04/meteo-soleggiato.jpg)";
  }else if(logo === "Parzialmente soleggiato"){
    $("#mattinaa").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
    document.getElementById('descrivimattina').style.background = "#8fffea"
  }else if(logo === "Piovoso"){
    document.getElementById('matt').style.backgroundImage = "url(https://trani.news24.city/wp-content/uploads/sites/14/2019/04/PIOGGIA-MALTEMPO-METEO.jpg)";
      document.getElementById('descrivimattina').style.color = "white"
      document.getElementById('mattt').style.color = "white"
    $("#mattinaa").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
  }else if(logo === "Temporali"){
    document.getElementById('matt').style.backgroundImage = "url(https://www.malpensa24.it/wp-content/uploads/2020/08/temporali-grandine-calo-termico.jpg)";
      document.getElementById('descrivimattina').style.background = "#141C2F"
      document.getElementById('descrivimattina').style.color = "white"
    $("#mattinaa").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
  }else if(logo === "Nuvoloso"){
    $("#mattinaa").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png")
    document.getElementById('mattt').style.color = "white"
    document.getElementById('descrivimattina').style.color = "white"
    document.getElementById('descrivimattina').style.background = "#626363"
    document.getElementById('matt').style.backgroundImage = "url(https://www.malpensa24.it/wp-content/uploads/2018/11/nuvole-cielo-coperto.jpg)";


  }
  document.getElementById('descrivimattina').innerHTML = descrivi

})



firebase.database().ref("simbolo").on("child_added", function (snapshot) {
    var logo = snapshot.val().sender
    var log = document.getElementById('logo');
    if(logo === "Soleggiato"){
      console.log('Soleggiatoooo!')
      $("#simboloo").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
    }else if(logo === "Parzialmente soleggiato"){
      $("#simboloo").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
    }else if(logo === "Piovoso"){
      $("#simboloo").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
    }else if(logo === "Temporali"){
      $("#simboloo").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
    }else if(logo === "Nuvoloso"){
      $("#simboloo").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png")
    }

})

function animatutto(){
  console.log('funzione partita')
  $("#mattinaa").animate({
    width: "125px"
  }, 1000)
  $("#pomeriggioo").animate({
    width: "125px"
  }, 1000)

}

firebase.database().ref("Allerte").on("child_added", function (snapshot) {
  var all = snapshot.val().message;
  var tipo = snapshot.val().sender;

  document.getElementById('display').innerHTML += "<hr style='width: 200px; background-color: white;'></hr>"
  document.getElementById('display').innerHTML += '<br><br><br><center><span id="all"></span><p class="ntext a"><strong>Allerte</strong></p><hr style="width: 750px; height: 3px; background: #696969;"></hr><p id="ntext">' + all + '</p></center>'
  if(tipo === "rosso"){
  document.getElementById("all").innerHTML = '<span class="material-icons md-75 red">error</span>'
}else if(tipo === "giallo"){
  document.getElementById("all").innerHTML = '<span class="material-icons md-75 yellow">error</span>'
}else if(tipo === "verde"){
  document.getElementById("all").innerHTML = '<span class="material-icons md-75 green">error</span>'
}
})
        firebase.database().ref("Temperature").on("child_added", function (snapshot) {
          var temp = snapshot.val().message;
          var rapporto = snapshot.val().sender;

          document.getElementById('display').innerHTML += "<br><div class='aumentoediminuzione'><center><span class='material-icons md-48' id='aedtempspan'></span></center></div><div id='temperatura' class='dettagli'><span class='material-icons md-48'>device_thermostat</span><p class='dettglitext' id='dettglitext'> Temperature</p></div><p class='ntext infod'>" + temp + "</p>"

          if(rapporto === "In aumento"){
            document.getElementById("aedtempspan").innerHTML = "trending_up"
          }else if(rapporto === "In diminuzione"){
            document.getElementById("aedtempspan").innerHTML = "trending_down"
          }else if(rapporto === "Stabile"){
            document.getElementById("aedtempspan").innerHTML = "arrow_right_alt"
          }else{
            document.getElementById("aedtempspan").innerHTML = "update_disabled"
          }
        })

        firebase.database().ref("Venti").on("child_added", function (snapshot) {
          var venti = snapshot.val().message;
          var rapporto = snapshot.val().sender;

          document.getElementById('display').innerHTML += "<br><div class='aumentoediminuzione'><center><span class='material-icons md-48' id='aedventspan'></span></center></div><div id='venti' class='dettagli'><span class='material-icons md-48'>speed</span><p class='dettglitext'> Venti</p></div><p class='ntext infod'>" + venti + "</p>"

          if(rapporto === "In aumento"){
            document.getElementById("aedventspan").innerHTML = "trending_up"
          }else if(rapporto === "In diminuzione"){
            document.getElementById("aedventspan").innerHTML = "trending_down"
          }else if(rapporto === "Stabile"){
            document.getElementById("aedventspan").innerHTML = "arrow_right_alt"
          }else{
            document.getElementById("aedventspan").innerHTML = "update_disabled"
          }
        })
        firebase.database().ref("preci").on("child_added", function (snapshot) {
          var prec = snapshot.val().message;
          var rapporto = snapshot.val().sender;

          document.getElementById('display').innerHTML += "<br><div class='aumentoediminuzione'><center><span class='material-icons md-48' id='aedprecispan'></span></center></div><div id='precipitazioni' class='dettagli'><span class='material-icons md-48'>water_drop</span><p class='dettglitext'> Precipitazioni</p></div><p class='ntext infod'>" + prec + "</p>"
          if(rapporto === "In aumento"){
            document.getElementById("aedprecispan").innerHTML = "trending_up"
          }else if(rapporto === "In diminuzione"){
            document.getElementById("aedprecispan").innerHTML = "trending_down"
          }else if(rapporto === "Stabile"){
            document.getElementById("aedprecispan").innerHTML = "arrow_right_alt"
          }else{
            document.getElementById("aedprecispan").innerHTML = "update_disabled"
          }

        })

        firebase.database().ref("dataagg").on("child_added", function (snapshot) {
          var dat = snapshot.val().message;

          document.getElementById('display').innerHTML += "<br><div id='dataaggiornamento' class='dettagli'><span class='material-icons md-48'>event</span><p class='dettglitext'> Data aggiornamento</p></div><p class='ntext infod'>" + dat + "</p>"
        })

        avviaahah()


        let tema = localStorage.getItem("tema");
        if(tema === "chiaro"){
          chiaro()
        }else if(tema === "scuro"){
          dark()
        }else if(tema === "automatico"){

        }
   }

   function comunita(){
     console.log('Comunità');
     var disp = document.getElementById("display")
     disp.innerHTML = "<p class='ltext'>Comunit&agrave; Meteo Marco</p><p class='ntext'>Qui puoi chattare con Marco in persona e con tutta la community appartenente a Meteo Marco.</p>"
     disp.innerHTML += '<div style="width: 90%; height: 800px; overflow: auto;" id="nuovimes"><span id="nuovimess"></span></div>'
    disp.innerHTML += '<center><form id="form"><input type="text" autocomplete="off" placeholder="Scrivi qui il messaggio" id="messaggioscrivi"></input></form><button onclick="inviamess()" id="invia"><span class="material-icons md-36">send</span></button></center>'

     firebase.database().ref("gruppocomunita").on("child_added", function (snapshot) {
       var mess = snapshot.val().message;
       var mittente = snapshot.val().sender;
       var ore = snapshot.val().ore;
       var data = snapshot.val().data;
       var s = snapshot.key
       var quantimess = document.getElementsByClassName("messaggio")
       var corretto = Number(quantimess.length)
       var corr = corretto++
       console.log(corr)
       localStorage.setItem("messletti", corr);
      var user = firebase.auth().currentUser;
       user.providerData.forEach(function (profile) {
         var email = profile.email
         if(profile.email === "marcoscortegagna009@gmail.com" || profile.email === "marco.scorte@outlook.it"){
           emaill = "Marco Express Official"
         }
      if(mittente == emaill){
        mittente = "Tu"
        document.getElementById('nuovimess').innerHTML += `<div class='messaggio' align="right"><p class='mittmesss'><strong>${mittente}&nbsp;</strong>Alle ore ${ore} del ${data} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button data-id = "${snapshot.key}" onclick="deleteMessage(this);" style="background: #67cf59; border: 2px solid #088201; height: 60px; width: 60px; border-radius: 30px;"><center><span class="material-icons md-36">delete</span></center></button><button data-id = "${snapshot.key}" onclick="modificamess(this);" style="background: #67cf59; border: 2px solid #088201; height: 60px; width: 60px; border-radius: 30px;"><center><span class="material-icons md-36">mode_edit</span></center></button></p><p class='messt' id='message-${snapshot.key}'>${mess}</p></div><br>`
      }else{
        document.getElementById('nuovimess').innerHTML += `<div class='messaggio'><p class='mittmess'><strong>&nbsp;${mittente}</strong> - Alle ore ${ore} del ${data}</p><p class='messt'>${mess}</p></div><br>`
      }
      div();
   })
       console.log(mittente)
     })
   }
   function deleteMessage(self) {
       // get message ID
       var messageId = self.getAttribute("data-id");

       // delete message
       firebase.database().ref("gruppocomunita").child(messageId).remove();
   }

   firebase.database().ref("gruppocomunita").on("child_removed", function (snapshot) {
       // remove message node
       document.getElementById("message-" + snapshot.key).innerHTML = '<span class="material-icons md-36">not_interested</span> Questo messaggio è stato eliminato'
   });

   function modificamess(self){
     var messageId = self.getAttribute("data-id");

     var nuovomess = prompt("Inserisci il nuovo messaggio")
     firebase.database().ref("gruppocomunita/" + messageId).update({
  message: nuovomess
}, (error) => {
  if (error) {
    // The write failed...
  } else {
    // Data saved successfully!
  }
});
   }

   firebase.database().ref("gruppocomunita").on("child_changed", function (snapshot) {
        var mess = snapshot.val().message;
       // remove message node
       document.getElementById("message-" + snapshot.key).innerHTML = mess
   });

   function piuinfo(self){
     var messageId = self.getAttribute("data-id");
   }

   var inputdue = document.getElementById("messaggioscrivi");

   inputdue.addEventListener("keydown", function (e) {
   if (e.keyCode == 13) {
   inviamess();
   }
   });


   function inviamess(){

     var scrivimess = document.getElementById("messaggioscrivi").value
     document.getElementById("form").reset();
     var user = firebase.auth().currentUser;
      user.providerData.forEach(function (profile) {
     if(scrivimess === " "){
       console.log("Troppo corto")
     }else if(scrivimess.length > 500){
       console.log("Troppo lungo")
       document.getElementById("nuovimess").innerHTML += "<center><div style='border: 4px solid red; border-radius: 15px; width: 80%; height: 25%;'><p class='ntext'><span class='material-icons md-36 red'>error_outline</span><strong> Messaggio troppo lungo<strong></p><p style='font-size: 25px;'>Il Tuo messaggio &egrave; troppo lungo: supera i 500 caratteri.</p></div></center>"
     }else{

       var datadue = new Date();
       orad = datadue.getHours();
       min = datadue.getMinutes();
       giorno = datadue.getDate();
       mese = datadue.getMonth();
       mese++
       var ore = orad + ":" + min
       var datacompleta = giorno + "/" + mese + "/" + "2021"
       var email = profile.email
       if(profile.email === "marcoscortegagna009@gmail.com" || profile.email === "marco.scorte@outlook.it"){
         email = "Marco Express Official"
       }


       const dbRef = firebase.database().ref();
     dbRef.child('messaggiinviaticomm').get().then((snapshot) => {
       if (snapshot.exists()) {
         console.log(snapshot.val());
         var ok = snapshot.val().totale
        var numero = Number(ok);
        var invia = numero + 1
         firebase.database().ref('messaggiinviaticomm').update({
           totale: invia
         })
       } else {
         console.log("No data available");
       }
     }).catch((error) => {
       console.error(error);
     });

     firebase.database().ref("gruppocomunita").push().set({
        "ore": ore,
         "sender": email,
         "message": scrivimess,
         "data": datacompleta
     });
     return false;
   }
 });
   }

   function div() {
     document.getElementById('nuovimes').scrollTop = 10000000000000
   }

   function avviaahah() {
     setTimeout(aaaa, 13500)

   }
   function aaaa(){

     $('#temperatura').animate({
       height: "75px",
       width: "35%"
     }, 800 , function(){

       $('#venti').animate({
         height: "75px",
         width: "35%"
       }, 800 , function(){

         $('#precipitazioni').animate({
           height: "75px",
           width: "35%"
         }, 800 , function(){
           $('.dettglitext').fadeIn(3000);

         })
       })
     })
   }

     function tuoacc(){
       let tema = localStorage.getItem("tema");
       var tipotema
       if(tema === "chiaro"){
         tipotema = "chiaro"
       }else if(tema === "scuro"){
         tipotema = "scuro"
       }else if(tema === "automatico"){
         let temaor = localStorage.getItem("temaorario");
         tipotema = "automatico: chiaro fino alle ore 20:00."
       }

       document.title = "Meteo Marco - Account ME";
       document.getElementById("display").innerHTML =" ";
       document.getElementById('display').innerHTML = "<p id='ttext'>Personalizzazione</p>" + '<hr align="left" size="1" width="600" color="#919191" noshade>'
       var seleziona = '<select id="selezionatema" style="width: 20%; height: 100px; font-size: 30px; border: 2px solid #0096bf; border-radius: 15px; background-color: #b9ccfa;"><option value="chiaro"><p>Chiaro</p></option><option value="scuro"><h1>Scuro</h1></option></select>'
       document.getElementById('display').innerHTML += "<p id='ntext'>Tema: " + tipotema + "</p><br>" + seleziona + "&nbsp;&nbsp;&nbsp;&nbsp;<button onclick='confermatema()' style='width: 10%; border: 3px solid #0096bf; border-radius: 10px; background-color:#e3ebff;'><h1>Salva</h1></button>"
       document.getElementById('display').innerHTML += "<p id='ttext'>Informazioni Account</p>" + '<hr align="left" size="1" width="600" color="#919191" noshade>'

       var user = firebase.auth().currentUser;
       if (user != null) {
         user.providerData.forEach(function (profile) {
          console.log("Sign-in provider: " + profile.providerId);
          console.log("  Provider-specific UID: " + profile.uid);

          console.log("  Name: " + profile.displayName);
          //document.getElementById('display').innerHTML += "<p id='ntext'>" + "Nome: <span id='nome'>" + profile.displayName + "</span>&nbsp;&nbsp;&nbsp;&nbsp;<button onclick='modnome()' id='modnome'><img src='https://lh3.googleusercontent.com/pw/ACtC-3da3hW4dsZX5PbU-tHhQjjutzLdZalnhafSWjPTYDusOcQpV3Q0GM7lXsa2wmAomFEv0RBE500H8EbisBrcBCTUZ3lO5ZtkKWkdc95ZEYTHvIR_gKFKkrk0EfPacCbUN10t1_bkr11qZ5A-kSep27Yf=s24-no?authuser=0' width='40px'/></button>"
          console.log("  Email: " + profile.email);
          document.getElementById('display').innerHTML += "<p id='ntext'>" + "Email: " + profile.email
          console.log("  Photo URL: " + profile.photoURL);
          document.getElementById('display').innerHTML += "<p id='ntext'>" + "Password: <span id='passwordo'>" + "**************" + "</span>&nbsp;&nbsp;&nbsp;&nbsp;<button onclick='modpw()' id='modnome'><img src='https://lh3.googleusercontent.com/pw/ACtC-3da3hW4dsZX5PbU-tHhQjjutzLdZalnhafSWjPTYDusOcQpV3Q0GM7lXsa2wmAomFEv0RBE500H8EbisBrcBCTUZ3lO5ZtkKWkdc95ZEYTHvIR_gKFKkrk0EfPacCbUN10t1_bkr11qZ5A-kSep27Yf=s24-no?authuser=0' width='40px'/></button>"
          document.getElementById('display').innerHTML += "<p id='ntext'>" + "Scadenza dell'abbonamento:  " + profile.photoURL
          document.getElementById('display').innerHTML += '<br>' + '<button onclick="signOut()" id="signOut"><h1>Logout</h1><img src="https://lh3.googleusercontent.com/pw/ACtC-3fxEqyRV4Kgd6Zq9ZYJSi8aBG4TOp5qqBYOGl7OnRZUogm68jgxH4UIwV2rIi1pIUDv62xzfK4Cwbj_xIQyKVdqMtGtecPJa3t36jMGNe4bS_7_5h8QrdJH6lMSlc-9vmqzvKUcR5tGcj7zNqJpY_la=s24-no?authuser=0" height="50px"></img></button>'
          document.getElementById('display').innerHTML +='&nbsp;&nbsp;&nbsp;<button onclick="elimabb()" id="signOut"><h1>Elimina l\'abbonamento*</h1><h2><br>Attenzione! L\'eliminazione dell\'abbonamento non comporta NESSUN rimborso.</h2></button><br><p id="ntext">Gestisci i tuoi pagamenti accedentdo al portale ufficiale <a href="gestionepagamenti.html">cliccando qui</a>.</p><h2>Quando hai creato il tuo account, hai accettato le <a href="https://docs.google.com/document/d/19Mgx9IHb-IxL0nMT4j_Le_YNjQQFHJBy2KwLtY4yCa8/preview"  target="_blank">Condizioni d\'uso</a>. Per visualizzarle, <a href="https://docs.google.com/document/d/19Mgx9IHb-IxL0nMT4j_Le_YNjQQFHJBy2KwLtY4yCa8/preview" target="_blank">CLICCA QUI</a>'
        });
      }

      var datadue = new Date();
      orad = datadue.getHours();
      if(orad >= 20){
        dark();
      }

     }

     function confermatema(){
       var tiposalva = document.getElementById("selezionatema").value
       if(tiposalva === "chiaro"){
         localStorage.setItem("tema", "chiaro");
       }if(tiposalva === "scuro"){
         localStorage.setItem("tema", "scuro");
       }/*if(tiposalva === "automatico"){
         localStorage.setItem("tema", "automatico");
       }*/
       window.location.reload()
     }

     function elimabb() {
       var user = firebase.auth().currentUser;

user.updateProfile({
    photoURL: " "
    }).then(function() {

      var datadue = new Date();
      orad = datadue.getHours();
      min = datadue.getMinutes();
      dataduen = datadue.getDate();
      mesed = datadue.getMonth();
      annodue = datadue.getFullYear();
      mesed++
      var mess = "Ha eliminato l'abbonamento Meteo Marco Premium plus nel giorno " +  dataduen + "/" + mesed + "/" + annodue + " alle ore " + orad + ":" + min
      firebase.database().ref("persone elimina abb").push().set({
          "sender": user.email,
          "message": mess

      });
      alert('Abbonamento Eliminato!')
      window.location.reload()
    }).catch(function(error) {
      alert('Errore, riprova tra qualche istante')
    });
     }




     function modnome() {
       document.getElementById("modnome").style.display="none";
       document.getElementById('nome').innerHTML = " "
       document.getElementById('nome').innerHTML = "<input type='text' id='nuovonome' placeholder='Inserisci nuovo nome'></input>" + "<button onclick='confermanome()' id='confermanome'><h1>Conferma</h1></button>"

     }

     function modpw() {
       document.getElementById('display').innerHTML = "<p id='ttext'>Per maggiore sicurezza, abbiamo inviato un'email al tuo indirizzo email</p><span id='infooo'></span>"
       document.getElementById('display').innerHTML += "<h2>Non &egrave; arrivata nessuna email? Prova a controllare la spam.</h2>"
       var user = firebase.auth().currentUser;
       var auth = firebase.auth();
       var emailAddress = user.email;

       auth.sendPasswordResetEmail(emailAddress).then(function() {
         console.log('fatto')
         document.getElementById('infooo').innerHTML = '<h1>Fatto, abbiamo inviato un\'email a ' + emailAddress + '</h1>'
       }).catch(function(error) {
          document.getElementById('infooo').innerHTML = '<h1>Spiacenti. Si &egrave; verificato un errore imprevisto</h1><br><button onclick="window.reload()" id="home"><h1>Torna alla home</h1></button>'
       });

     }

     function confermanome() {
       var user = firebase.auth().currentUser;
       var newnome = document.getElementById('nuovonome').value
       user.updateProfile({
      displayName: newnome

    }).then(function() {
      tuoacc();
    }).catch(function(error) {
      console.log('errore')
    });
     }

     function aggiornaprevisioni(){
       premiumplus()
       $("#aggprevisioni").css("cursor","no-drop");
       document.getElementById('aggiornato').innerHTML = " "
      $("#aggiornato2").fadeIn("slow")
       document.getElementById('aggiornato2').innerHTML = "check_circle"
       setTimeout(cambiaag, 2000)
       document.getElementById("aggprevisioni").disabled = true;
    return true;
     }

     function cambiaag(){

       if(navigator.online = true){
         document.getElementById('aggiornato').innerHTML = "update"
         document.getElementById('aggiornato2').innerHTML = " "
         document.getElementById("aggprevisioni").disabled = false;
          $("#aggprevisioni").css("cursor","pointer");
      return false;
    }else{
      document.getElementById('aggiornato').innerHTML = "error"
      document.getElementById('aggiornato2').innerHTML = " "
      document.getElementById("aggprevisioni").disabled = true;
   return true;
    }

     }

     function previsionipp() {
       premiumplus();
       escecomm();
     }

     function datipp() {
       var datadue = new Date();
       orad = datadue.getHours();
       if(orad >= 20){
         dark();
       }
       document.title = "Meteo Marco - Dati meteo";
       console.log('datipp');
       document.getElementById('display').innerHTML = '<button onclick="datireal()" id="datidue"><h1>Richiedi dati real time</h1></button>';
       document.getElementById('display').innerHTML += '<br><button onclick="datiipp()" id="datidue"><h1>Visualizza documento intero</h1></button>';
       document.getElementById('display').innerHTML += '<br><br><center><iframe height="90%" src="https://drive.google.com/file/d/1DCtSum9FyM9JTNZ00ONTRVuhGo5ro1Jp/preview" width="90%"><h1>Caricamento...</h1></iframe></center>'


     }

     function datiipp() {
       location.assign('https://drive.google.com/file/d/1DCtSum9FyM9JTNZ00ONTRVuhGo5ro1Jp/preview');
     }

     function datireal() {
       document.getElementById('display').innerHTML = '<p id="ntext"> Per la richiesta dei dati real time, non &egrave; disponibile riceverli in questo sito. Attendi la prossima versione per averli disponibili. Naturalmente, visto il tuo abbonamento attivo, &egrave; disponibile ricevere i dati tramite WhatsApp o Gmail.</p>'
     }


     function premium() {
       console.log('Premium')

         firebase.database().ref("Meteo Marco Premium").on("child_added", function (snapshot) {
           var testoo = snapshot.val().message;

           console.log(testoo);

         });

     }

     function showPwd() {
       var input = document.getElementById('password');
       if (input.type === "password") {
         input.type = "text";
       } else {
         input.type = "password";

       }
     }

     function ascolta() {
       var audio = new Audio('meteomarco.mp3');
      audio.play();

      window.setTimeout('asc()', 2000)

    }

    function asc() {
      firebase.database().ref("Meteo Marco Premium Plus").on("child_added", function (snapshot) {
        var testopo = snapshot.val().message;
        var titolopo = snapshot.val().sender;

        var msg = new SpeechSynthesisUtterance(testopo);
        window.speechSynthesis.speak(msg);
      });
    }



    //Annullamento dell'abbonamento

    function controllaabb() {
      var user = firebase.auth().currentUser;
 user.providerData.forEach(function (profile) {
   var piusett = profile.photoURL
   console.log(piusett)
   const second = 1000,
         minute = second * 60,
         hour = minute * 60,
         day = hour * 24;

   let birthday = piusett,
       countDown = new Date(birthday).getTime(),
       x = setInterval(function() {

         let now = new Date().getTime(),
             distance = countDown - now;

         //do something later when date is reached
         if (distance < 0) {
           console.log('ALLARME')
           user.updateProfile({
               photoURL: " "
               }).then(function() {
                 window.location.reload()
               }).catch(function(error) {
                 alert('Errore: ' + error.name)
               });
           clearInterval(x);
         }
         //seconds
       }, 0)
 })


    }

    function noprevisioni(){
      document.getElementById('display').innerHTML = '<center><span class="material-icons md-150 red">error_outline</span><p id="ttext">Il server ci sta mettendo troppo tempo a rispondere</p><p id="ntext">Verifica la connessione e riprova. Se il problema persiste, contatta un tecnico Marco Express.<br><br>Tentativo di riconnessione...</p></center>'
      setTimeout(rigeneraconnessione, 100)
    }
    function rigeneraconnessione(){
      if(navigator.onLine){
        document.getElementById("display").innerHTML = "<center><h2>Ricerca errori...</h2></center>"
        document.getElementById("display").innerHTML += "<center><h3>Attendere prego...</h3></center>"
        document.getElementById("display").innerHTML += "<center><br><img width='150px' src='https://lh3.googleusercontent.com/pw/ACtC-3cqK5HaPD1DJzuJsNl1G2Pa-1hWvH87lpVYGv2BL5Wz8rpuBN4f-L9lTwFVE0VdgL5FjpEumgkfOMAyutTQu2--Sjd_5xfj1ir-qLu3EKoqsZb-WJS5N3SH21wUyd2e1MoQW6YjVkh0IgFfuYrmTt8R=w64-h22-no?authuser=0'></img></center>"
        setTimeout(ri,1500)
      }else{
        setTimeout(rigeneraconnessione,100)
      }
    }
    function ri() {
      document.getElementById("display").innerHTML = "<center><h2>Rigenerazione della connessione...</h2></center>"
      document.getElementById("display").innerHTML += "<center><h3>Attendere prego...</h3></center>"
      document.getElementById("display").innerHTML += "<center><br><img width='150px' src='https://lh3.googleusercontent.com/pw/ACtC-3cqK5HaPD1DJzuJsNl1G2Pa-1hWvH87lpVYGv2BL5Wz8rpuBN4f-L9lTwFVE0VdgL5FjpEumgkfOMAyutTQu2--Sjd_5xfj1ir-qLu3EKoqsZb-WJS5N3SH21wUyd2e1MoQW6YjVkh0IgFfuYrmTt8R=w64-h22-no?authuser=0'></img></center>"
      setTimeout(premiumplus, 1500)
    }


    //Nuovi mess e community Impostazioni


    function escecomm(){
      var messaggiletti = localStorage.getItem("messletti");
      console.log(messaggiletti)
      var numcorrezione = Number(messaggiletti)
      console.log(numcorrezione)
      var corr = numcorrezione + 1
      console.log(corr)
      var invio = "" + corr
      var user = firebase.auth().currentUser;
        firebase.database().ref('Utenti/' + user.uid).update({
          numeromessaggiletti: invio
      })
    }

    function messaggidaleggere(){
        var user = firebase.auth().currentUser;
      var starCountRef = firebase.database().ref('Utenti/' + user.uid);
    starCountRef.on('value', (snapshot) => {
      const data = snapshot.val();
      console.log(data);
      console.log(data.numeromessaggiletti)
      var messletti = data.numeromessaggiletti
      var numero = Number(messletti);
     localStorage.setItem("messletti", numero);
    });


    var altro = firebase.database().ref('messaggiinviaticomm');
  altro.on('value', (snapshot) => {
    const dataa = snapshot.val();
    var mess = dataa.totale
    var numero = Number(mess);
    var messaggiletti = localStorage.getItem("messletti");
    var messlett = Number(messaggiletti)
    console.log(numero)
    console.log(messlett)
    var differenza = numero - messlett
    console.log(differenza)
    if(differenza === 0){
      console.log("nonhaimessaggidaleggere")
    }else if(differenza > 0){
      console.log("Hai " + differenza + " messaggi da leggere")
      var oi
      var messaggi
      if(differenza === 1){
        oi = "o"
        messaggi = "o"
      }else{
        oi = "i"
        messaggi = ""
      }
      //document.getElementById("display").innerHTML += `<div id='nuovimessss'><h1>Hai ${differenza} nuov${oi} messaggi${messaggi}!</h1><h2>Vai nella sezione community per visualizzarl${oi}.</h2><button onclick='comunita()' style='width: 70%; background: yellow; border: 2px solid black; border-radius: 25px;'><h1>Community</h1></button></div>`
     // setTimeout(chiudinuovimess , 8000)
    }

  });

    }
    function chiudinuovimess(){
     // $("#nuovimessss").fadeOut("slow")
    }





      </script>
      <style>
      .material-icons.md-18 { font-size: 18px; }
      .material-icons.md-24 { font-size: 24px; }
      .material-icons.md-36 { font-size: 36px; }
      .material-icons.md-48 { font-size: 48px; }
      .material-icons.md-60 { font-size: 60px; }
      .material-icons.md-75 { font-size: 75px; }
      .material-icons.md-150 { font-size: 150px; }
      .material-icons.red { color: red; }
      .material-icons.yellow { color: yellow; }
      .material-icons.green { color: #00b336; }
      .ltext{
        font-family: 'Raleway', sans-serif;
        font-size: 50px;
      }
      .ntext{
        font-family: 'Raleway', sans-serif;
        font-size: 35px;
      }
            body{
              font-family:"Josefin Sans", sans-serif;
            }

            button{
              cursor: pointer;
            }


            #hh{
            position: absolute;
            top:0px;
            right:0px;
            height: 100%;
            width: 100%;
            background-color: gray;
            z-index: 1000;
            opacity: .90;
            filter: alpha(opacity=90);
            -moz-opacity: .90;
            }

            #reiu{
              width: 65%;
              height: 75px;
             background: #d5dbd6;
             border-radius: 7px;
            }

            #rei{
              width: 90%;
              border: 3px solid black;
              background: #d5dbd6;
              font-size: 250%;
              border-radius: 15px;
              box-shadow: 10px 10px 5px #dedede;
            }

            #rlogin{
              height: 75px;
              width: 65%;
              background: #d5dbd6;
            }
            #confi{
              height: 75px;
              width: 65%;
              background: #d5dbd6;
            }

            #rlogin{
              width: 60%;
              font-size: 35px;
            }
            #home{
              width: 60%;

            }




            #ttext,#tttext{
              font-size: 50px;
            }
            #ntext{
              font-size: 40px;
            }
            .ntext.infod{
              font-size: 40px;
              padding-left: 20px;
            }
            #pomet{
              font-size: 40px;
            }
            #mattt{
              font-size: 40px;
            }
            #accessoc {
              width: 98%;
              height: 25%;
              position: fixed;

            }
            #ace{
              font-size: 100%;
            }

            #dati{
              width: 20%;
              height: 35%;
              background-color: #9d9ff2;
              border: 3px solid #0004de;
              letter-spacing: 2px;
              border-radius: 15px;
              box-shadow: 10px 10px 5px #dedede;
            }

            #previsioni{
              width: 30%;
              height: 35%;
              background-color: #afff9c;
              border: 3px solid #33ff00;
              letter-spacing: 2px;
              border-radius: 15px;
              box-shadow: 10px 10px 5px #dedede;
            }

              #inizio{
                height:350px;
              }
              #signOut {
                height: 25%;
                background: #f0cccc;
                width: 38%;
                border: 3px solid red;
                letter-spacing: 2px;
                border-radius: 15px;
                box-shadow: 10px 10px 5px #dedede;
              }
              #signIn {
                background: #b2f7bc;
                width: 200px;
                border: 3px solid #0af52c;
                letter-spacing: 2px;
                border-radius: 40px;
              }
              #password,#email {
                width:80%;
                background: #d5dbd6;
                border: 3px solid black;
                font-size: 250%;
                border-radius: 20px;
                box-shadow: 15px 10px 5px #dedede;

              }
              #button {
                background: #d5dbd6;
                border: 3px solid black;
                font-size: 120%;
              box-shadow: 15px 10px 5px #dedede;
              }

              #datidue {
                width: 98%;
                height: 10%;
                border: 2px solid #00c3ff;
                letter-spacing: 2px;
                background-color: #73ebe1;
                border-radius: 15px;
                box-shadow: 10px 10px 5px #dedede;
              }

              #modnome{
                width: 50px;
                height: 50px;
              }

              #nuovonome{
                font-size: 100%;
                width: 70%
              }

              #confermanome{
                width: auto;
                height: 75px;
              }

              #ascolta{
                width: 750px;
                height: 75px;
              }

              #feed{
                position: fixed;
                bottom: 10px;
                height: 50px;
                width: 300px;
                border-radius: 25px;
                right: 5px;
              }
              #due{
                position: fixed;
                bottom: 10px;
                height: 50px;
                width: 300px;
                border-radius: 25px;
                right: 320px;
              }
              .dettagli{
                width: 80px;
                height: 80px;
                border-radius: 37.5px;
                display: flex;
                justify-content: center;
                align-items: center;

              }
              .dettglitext{
                display: none;
              }
              .ntext.a{
                font-size: 42px;
              }
              #temperatura{
                border: 5px solid red;
                background-color: #ff8282;
              }
              #venti{
                border: 5px solid yellow;
                background-color: #f9ff82;
              }
              #precipitazioni{
                border: 5px solid #00b5ff;
                background-color: #b0e8ff;
              }
              #dataaggiornamento{
                width: 45%;
                border: 5px solid #8c00ff;
                background-color: #bd6eff;
              }

              .dettglitext{
                font-family: 'Raleway', sans-serif;
                font-size: 36px;
              }
              .valriassunto{
                font-family: 'Raleway', sans-serif;
                font-size: 30px;
              }
              #ultim{
                font-family: 'Source Code Pro', monospazio;
                top: 90px;
              }
              #ultima{
                width: 100%;
                height: 200px;
                background-image: url("https://lh3.googleusercontent.com/pw/AM-JKLUFiD_dbz-alodAMi71i9dIIXbArYEs8gioAhyVM1psrn4qh0qg1hBo7QWfY5h7Tcc8q7d8vOm4VjvoZt8oTGj23hZCgt1mzN8-g7lWdLzn_JpTM5HQ0jK8IRF_aCGIcak36Q6eVEV95TzsyH3_vi5f=s512-no?authuser=0");
                background-repeat: no-repeat;
                background-position: left;
                background-size: contain;
                background-color: #bfbaba;
              }
              .dettaglipre{
                padding: 15px;
                width: 45%;
                height: 400px;
                border: 1px solid #615c5c;
                border-radius: 15px;
                left: 25px;
                background-image: url("https://script.meteolive.it/admin/immaginiNotizie/SRC/__070003___parziale.jpg");
                background-repeat: no-repeat;
                background-size: cover;
                background-position: center;


              }
              .dettore{
                font-family: 'Raleway', sans-serif;
                font-size: 30px;
              }
              #pomeriggio{
                padding: 15px;
                float: right;
                width: 45%;
                right: 25px;
                height: 400px;
                border: 1px solid #615c5c;
                border-radius: 15px;
                background-image: url("");
                background-repeat: no-repeat;
                background-size: cover;
                background-position: center;
                opacity: 1.0;

              }

      #loading_screen{
        position: absolute;
        top:0px;
        right:0px;
        height: 100%;
        width: 100%;
        background-color: gray;
        z-index: 1000;
        opacity: .75;
        filter: alpha(opacity=75);
        -moz-opacity: .75;

      }

      #primoacc{
        position: absolute;
        top:0px;
        right:0px;
        height: 100%;
        width: 100%;
        background-color: gray;
        z-index: 1000;
        opacity: .90;
        filter: alpha(opacity=75);
        -moz-opacity: .75;
      }

      #casella{
        width: 80%;
        background: white;
        opacity: .95;
        border-radius: 15px;
        box-shadow: 10px 10px 5px #dedede;
      }
      #cb{
        ms-transform: scale(3); /* IE */
          -moz-transform: scale(3); /* FF */
          -webkit-transform: scale(3); /* Safari and Chrome */
          -o-transform: scale(3); /* Opera */
          transform: scale(3);
          padding: 10px;
      }

      #btn{
        background: red;
        font-size: 30px;
        height: 60px;
        width: 65%;
        opacity: .99;

      }
      #d{
      float: left; padding: 15px 15px 15px 15px;
      }
      #pp{
        width: 98%;
        height: auto;
      border: 5px double black;
      border-radius: 15px;
      box-shadow: 10px 10px 5px #dedede;
      }
      #ppabbn{
        width: 100%;
        height: 75px;
      }
      #selezionaabb{
        width: 90%;
        height: 100px;
      }
      #aggprevisioni{
        width: 75px;
        height: 75px;
        border-radius: 37.5px;
        float: right;
      }
      .messaggio{
        width: inherit;
        padding-left: 15px;
        padding-right: 15px;
        padding-bottom: 10px;
        height: auto;
        background: #f5f5f5;
        border-radius: 7px;

      }
      .mittmess{
        font-family: 'Oswald', sans-serif;
        font-size: 25px;
        background-color: #c5c9c6
      }
      .mittmesss{
        font-family: 'Oswald', sans-serif;
        font-size: 25px;
        background-color: #67cf59

      }
      .messt{
        font-family: 'Noto Sans KR', sans-serif;
        font-size: 30px;
      }
      #messaggioscrivi{
        width: 90%;
        border: 2px solid #707070;
        background-color: #adadad;
        height: 50px;
        border-radius: 25px;
        font-size: 32px;
      }
      #invia{
        height: 60px;
        width:60px;
        border-radius: 25px;
        border: 3px solid #ffff00;
        background: #ffff52;
      }
      .aumentoediminuzione{
        width: 80px;
        height: 80px;
        border-radius: 40px;
        border: 3px solid black;
        float: left;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #ebebeb;
      }
      #nuovimessss{
        position: fixed;
        top: 30px;
        right: 10px;
        width: 50%;
        height: 200px;
        border: 2px solid black;
        border-radius: 15px;
        background-color: white;
        padding: 15px;
      }

      </style>

        <br><br><br><br>
        <center><img src='Copyright.jpg' height='150px' width='70%'></img></center>
      </body>
      </html>
