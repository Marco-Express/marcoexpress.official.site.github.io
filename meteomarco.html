<html>
<head>
  <link rel='icon' type='image/ico”' href='https://lh3.googleusercontent.com/pw/AM-JKLXGUw7IN1wheeQ2k3knaICulaSvgZKwIo98ll6xF7VytX9iyQG4Qkb4LWkjVdDJxkHm2QKjedb0JPglpM1anVjRHsqh2SwIPZegaRHNerY1-XTflRE444BjQrNNcK3S0exgkzJFsmRO1Vwk5_SqGntk=s32-no?authuser=0'>
  <title>Meteo Marco v 2.18</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

      <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@500&display=swap" rel="stylesheet">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-1EFHH3K88D"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

  gtag('config', 'UA-204455590-1');
gtag('config', 'G-1EFHH3K88D');
</script>
</head>
<body>

  <div id="copri"><br>
    <center><span class="material-icons md-75 white" id="serratura">lock</span></center>
    <center><span id="totale"></span></center>
    <center><h1 id="testomacchinascrivi"></h1></center>
    <center><h1 id="testomacchinascrivi2"></h1></center>
    <center><h1 id="avvisiederrori"></h1></center>
  </div>

  <div id="nientesoldi">
    <center>
      <span class="material-icons md-75 red">sentiment_dissatisfied</span>
      <h1 id="1niente">Non hai i soldi necessari per l'acquisto.</h1>
      <h2 id="2niente">Hai richiesto il rinnovo automatico, ma non hai il denaro necessario per pagare 1 settimana di Meteo Marco</h2>
    </center>
  </div>

<div id="tuttopernascondere">
  <span id="dati"><center>
    <h1>Massima del 2020!</h1>
    <table>
      <tr><td>/</td><td>Massima</td><td>Data di ricezione</td></tr>
      <tr><td>Temperature</td><td>43,6 °C</td><td>08/8  15:00</td></tr>
      <tr><td>Umidit&agrave;</td><td>99%</td><td>02/3  0:46</td></tr>
      <tr><td>Vento</td><td>36,7 km/h</td><td>04/2  23:02</td></tr>
      <tr><td>Pioggia</td><td>90,8 mm*</td><td>04/2  23:02</td></tr>
    </table>
    <h3>*=90,8 litri su m<sup>2</sup></h3>
    <h1>Minime del 2020!</h1>
    <table>
      <tr><td>/</td><td>Minima</td><td>Data di ricezione</td></tr>
      <tr><td>Temperature</td><td>-6,2 °C</td><td>15/2  7:00</td></tr>
      <tr><td>Umidit&agrave;</td><td>11%</td><td>28/2  14:48</td></tr>
    </table>

    <h1>Dati raccolti nel 2020 dalla stazione meteorologica di Meteo Marco</h1>

    <iframe height="70%" src="https://drive.google.com/file/d/1DCtSum9FyM9JTNZ00ONTRVuhGo5ro1Jp/preview" width="90%"><h1>Caricamento...</h1></iframe></center>
    </span>

     <span id="community">
       <center><div id="infomessdiv" style="width:80%; height:60%; opacity: 0.9;background-color: #6b6a6a;position:fixed;border-top-right-radius:100px;border-bottom-left-radius:100px;top:10%;left:10%;">
         <br><br>
         <span id="spaninfo"></span>
         <h1 style="font-size:35px;color:white;" id="titoloinfo"></h1>
         <h1 style="font-size:29px;color:white;" id="descriviinfo"></h1>
       </div></center>
      <div id="tuttiimess" style="overflow-y: scroll; width: 100%; height: 85%;"></div>
      <textarea id="messaggio" placeholder="Scrivi qui il tuo messaggio" style="width: 90%; font-size: 40px; border: 3px solid black; border-radius: 15px;"></textarea><button onclick="inviamess()" id="inviamess" style="height: 80px; width: 80px; border-radius: 40px; float: right; background-color: white; border: 3px solid black;"><span class="material-icons md-48">send</span></button>
      </span>

  <span id="display">
    <h1 id="saluta">Ciao, </h1>
    <h1 id="saluto2"></h1>
    <div id="immaginesenzazione"></div>
    <br><br><br>
    <div id="previsionicomp"><div id="previsionitutti"></div><br><br><br>
    <div id="ascoltavic"><span id="attendibilita"></span><button id="ascolta" onclick="ascolta()"><span class="material-icons md-50">hearing</span></button></div><br>
    <h1 id="titoloprevisioni" style="position: absolute;"></h1><br><br><br><br>
    <h2 id="testoprevisioni" style="position: absolute;"></h2><br><br><br>
    <div id="orainora"></div>
  </div>
  </span>

  <span id="news">
    <br>
    <center><h1>Notizie meteorologiche direttamente da Meteo Marco!</h1>
    <button style="border:1px solid black; border-radius: 20px;" onclick="document.getElementById('spieganews').style.display = 'block'"><h2 style="font-size: 30px;"><span class="material-icons md-36">help_outline</span> <strong>Bisogno d'aiuto?</strong></h2></button>
    <h2 id="nonews">Ancora nessuna notizia! Torna presto!</h2></center>
    <div style="overflow:scroll; height:100%; width:100%;">
      <br><br>
    <center><span id="mostranews">
  </span></center></div>


  </span>

  <div id="spieganews" style="position:fixed; width:100%; height:100%;background-color: white; left: 0px; top:0px; overflow:auto;">
    <center>
    <span class="material-icons red md-85">warning</span>
    <h1>Allerta</h1>
    <h2 style="font-size: 39px;">Nel caso in cui si dovessero verificare dei fenomeni meteorologici di forte intensit&agrave;, Meteo Marco avvertir&agrave; gli utenti qualche giorno prima grazie a questo tipo di simbolo.</h2>
    <h2 style="font-size: 35px;"><i>Esempio: Allerta pioggia: rischio nubifragi.</i></h2>
    <br>
    <span class="material-icons green md-85">insights</span>
    <h1>Tendenza</h1>
    <h2 style="font-size: 39px;">Una notizia con questo simbolo verde indica una tendenza, cio&egrave; delle previsioni a lungo termine. Esse, tuttavia, non sono molto affidabili.</h2>
    <h2 style="font-size: 35px;"><i>Esempio: Previsioni fornite luned&igrave; per 5 giorni dopo.</i></h2>
    <br>
    <span class="material-icons gray md-85">info</span>
    <h1>Informazione</h1>
    <h2 style="font-size: 39px;">Quando viene mostrato questo simbolo, significa che il contenuto della notizia &egrave; un'informazione. Possono essere di vario tipo: informazioni sulla temperatura, sui venti e sulle precipitazioni.</h2>
    <h2 style="font-size: 35px;"><i>Esempio: Oggi ha piovuto 55 mm.</i></h2>
    <br>
    <button style="width: 80px; height: 80px; border-radius: 40px; border: 2px solid black; background-color: white;" onclick="document.getElementById('spieganews').style.display = 'none'"><span class="material-icons md-48">arrow_back</span></button>

  </div>


</div>

  <div id="comprameteomarco" style="position:absolute; width:100%; height:100%;background-color: white;">
    <center>
      <img src="https://lh3.googleusercontent.com/pw/AM-JKLU5o18ZiaGNxX1ceX394jCHFofPC7XlplfrwTG18Jeo_7Ca-ISK0rTqkROh9fpRftmrCVMK4rUB-TKcie2wzjL0cti7TMEhduPusHYN0fDvfVFe4cED6jtkcq8p_RFa1xR1ZGM0WnSbPe8PW7_WnlJm=s903-no?authuser=0" width="300px"></img>
    <span id="compradopo"><h1>Acquista Meteo Marco</h1>
    <h2 style="font-size: 32px;">Il tuo abbonamento Meteo Marco Premium Plus &egrave; scaduto.<br>Acquista Meteo Marco ora per goderti moltissimi vantaggi.</h2>
    <button style="background-color: #0dd406; border: 0px; width: 35%; height: 150px; border-radius: 15px; float: left;" onclick="acquistaunasett()"><h1 style="font-family: 'Ubuntu', sans-serif;">Acquista Ora</h1><h2><b>1 Settimana</b></h2></button>

    <button style="background-color: red; border: 0px; width: 35%; height: 150px; border-radius: 15px; float: right; margin-left: 50px;" onclick="acquistaduesett()"><h1 style="font-family: 'Ubuntu', sans-serif;">Acquista Ora</h1><h2><b>2 Settimane</b></h2></button>

    </center>
    <hr color="white"></hr>
    <br><br><br><br><br><br><br>
    <div class="motivimm">
      <center><span class="material-icons md-150">refresh</span>
      <h1>Un sito sempre aggiornato</h1>
      <h2>Meteo Marco aggiorna le sue previsioni <strong>ogni</strong> giorno.</h2></center>
    </div>
    <div class="motivimm">
      <center><span class="material-icons md-150">tag_faces</span>
      <h1>Soddisfatti o rimborsati</h1>
      <h2>Disdici l'abbonamento quando vuoi e senza costi aggiuntivi.</h2></center>
    </div>
    <div class="motivimm">
      <center><span class="material-icons md-150">bar_chart</span>
      <h1>Dati storici</h1>
      <h2>Dati meteorologici del 2020 sempre disponibili. Provenienti direttamente dalla stazione meteorologica di Meteo Marco.</h2></center>
    </div>
    <div class="motivimm">
      <center><span class="material-icons md-150">check_circle_outline</span>
      <h1>Si effettuano rimborsi</h1>
      <h2>Qualora Meteo Marco non aggiornasse le previsioni, verr&agrave; aggiunto un giorno allo scadere dell'abbonamento.</h2></center>
    </div>
    <div class="motivimm">
      <center><span class="material-icons md-150">question_answer</span>
      <h1>Chatta con gli esperti</h1>
      <h2>Chiedi pi&ugrave; informazioni sul meteo chattando direttamente con Marco.</h2></center>
    </div>
    <div class="motivimm">
      <center><span class="material-icons md-150">euro_symbol</span>
      <h1>Alla portata di tutti</h1>
      <h2>Acquista Meteo Marco a soli &euro; 0,65 a settimana.</h2></center>
    </div>
</span>
  </div>

  <div id="menu">
    <button onclick="previsioni()" class="pulsantiera" id="previsioni"><img src="menumeteomarco/descriptionnoselect.svg" width="36px" id="previsioniimg"></img><br><h2 class="testopuls">Previsioni</h2></button>
    <button onclick="dati()" class="pulsantiera"><img src="menumeteomarco/pollnoselect.svg" width="36px" id="datiimg"></img><h2 class="testopuls">Dati</h2></button>
    <button onclick="community()" class="pulsantiera" id="communityyy"><div style="background-color:red; width: 10px; height: 10px; border-radius: 5px; float:right;" id="pallinocommunity"></div><img src="menumeteomarco/forumnoselect.svg" width="36px" id="communityimg"></img><h2 class="testopuls">Community</h2></button>
    <button onclick="post()" class="pulsantiera"><div style="background-color:red; width: 10px; height: 10px; border-radius: 5px; float:right;" id="pallinonews"></div><img src="menumeteomarco/articlenoselect.svg" width="36px" id="postimg"></img><h2 class="testopuls">News</h2></button>
    <button onclick="impostazioni()" class="pulsantiera"><img src="menumeteomarco/settingnoselect.svg" width="36px" id="impostazioniimg"></img><br><h2 class="testopuls">Impostazioni</h2></button>
  </div>
</body>
</html>
<script src="libreriamacchinascrivi.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-database.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-firestore.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-storage.js"></script>
<script>
const target = document.querySelector("#testomacchinascrivi")
const writer = new Typewriter(target, {
 loop: false,
 typeSpeed: 50,
 deleteSpeed: 80,
 typeColor: 'white'
})

writer
.type('Stiamo verificando che tu abbia i requisiti necessari per accedere')
.start()
setTimeout(dopopresentazione , 3000)

function dopopresentazione(){
 const targett = document.querySelector("#testomacchinascrivi2")
 const writerr = new Typewriter(targett, {
  loop: false,
  typeSpeed: 50,
  deleteSpeed: 0,
  typeColor: 'red'
})

writerr
.type('Attendere prego...')
.remove(3)
.type('...')
.start()
}

</script>
<script>
var firebaseConfig = {
  apiKey: "AIzaSyCIw0-w1C3zDjoGgVpLKsFYm2TFXqJr9yw",
  authDomain: "marco-express-d30c8.firebaseapp.com",
  projectId: "marco-express-d30c8",
  storageBucket: "marco-express-d30c8.appspot.com",
  messagingSenderId: "764621319758",
  appId: "1:764621319758:web:9390a4a994df27cda4dd1f",
  measurementId: "G-3ZK6NW0G3F"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
var database = firebase.database();
document.getElementById("ascoltavic").style.display = "none"
document.getElementById('spieganews').style.display = 'none'
document.getElementById('news').style.display = 'none'
document.getElementById('community').style.display = 'none'
  document.getElementById("infomessdiv").style.display = "none"
/*document.getElementsByClassName("pulsantiera")[0].disabled = true
document.getElementsByClassName("pulsantiera")[1].disabled = true
document.getElementsByClassName("pulsantiera")[2].disabled = true
document.getElementsByClassName("pulsantiera")[3].disabled = true*/

$("#messaggio").keyup(function(event) {
    if (event.keyCode === 13) {
        $("#inviamess").click();
    }
});

document.getElementById("messaggio").addEventListener("focus" , function(){
  console.log("okkkk")
  $("#tuttiimess").css("height" , "70%")
  document.getElementById("messaggio").style.border = "4px solid #03a306"
  document.getElementById('tuttiimess').scrollTop = 10000000000000
})
document.getElementById("messaggio").addEventListener("blur" , function(){
  console.log("okkkk")
  $("#tuttiimess").css("height" , "85%")
  document.getElementById("messaggio").style.border = "2px solid black"
})
function inviamess(){
  console.log("cssaaa")
  var user = firebase.auth().currentUser;
   user.providerData.forEach(function (profile) {
  var messaggio = document.getElementById("messaggio").value
  var dataattuale = new Date();
  oraattuale = dataattuale.getHours();
  minutiattuali = dataattuale.getMinutes();
  giornoattuale = dataattuale.getDate();
  meseattuale = dataattuale.getMonth();
  annoattuale = dataattuale.getFullYear();
  meseattuale++
  var datadainviare = giornoattuale + "/" + meseattuale + "/" + annoattuale
  var oradainviare = oraattuale + ":" + minutiattuali

const dbRef = firebase.database().ref();
dbRef.child("Utenti").child(user.uid).get().then((snapshot) => {
  var utente = snapshot.val();
  var nome = utente.Nome
  var email = user.email
  var imgprofilo = utente.Immagine
  if(imgprofilo === "No"){
    imgprofilo = "https://image.flaticon.com/icons/png/512/64/64572.png"
  }
  firebase.database().ref("Messaggi community").push().set({
     "datainvio": datadainviare ,
     "ora": oradainviare ,
     "messaggio": messaggio ,
     "mittente": nome,
     "emailmittente": email,
     "fotoprofilo": imgprofilo
  }, (error) => {
  if (error) {
    console.log(error);
    document.getElementById("tuttiimess").innerHTML += "<h2>Ore " + oraattuale + ":" + minutiattuali + ". IMPOSSIBILE INVIARE IL MESSAGGIO. Riprova</h2>"
  } else {
     document.getElementById("messaggio").value = " ";
     document.getElementById("messaggio").blur();
     dbRef.get().then((snapshot) => {
       var totalemess = snapshot.val().Totalemessaggicommunity
       totalemess++
       firebase.database().ref().update({
    Totalemessaggicommunity: totalemess
  });
     });
  }
});

});
})
}

function infomess(self){
  var Idmessaggio = self.getAttribute("data-id");
  var info = document.getElementById("descriviinfo")
  const dbRef = firebase.database().ref();
dbRef.child("Messaggi community").child(Idmessaggio).get().then((snapshot) => {
  if (snapshot.exists()) {
    var mess = snapshot.val()
    //Il messaggio esiste
    document.getElementById("spaninfo").innerHTML = "<img src='" + mess.fotoprofilo + "' style='max-width:500px;max-height:500px;border-radius:40px;'></img>"
    document.getElementById("infomessdiv").style.display = "block"
    document.getElementById("titoloinfo").innerHTML = "Informazioni messaggio"
    info.innerHTML = "Nome mittente: " + mess.mittente + "<br>"
    info.innerHTML += "Email mittente: " + mess.emailmittente + "<br>"
    info.innerHTML += "Data d'invio: " + mess.datainvio + "<br>"
    info.innerHTML += "Ora d'invio: " + mess.ora + "<br>"
    info.innerHTML += "ID univoco messaggio: " + Idmessaggio + "<br><br>"
    info.innerHTML += "<button onclick='noinfomess()'><span class='material-icons md-85'>clear</span></button>"
  } else {
    //Il messaggio non esiste
    info.innerHTML = "Il messaggio che hai cercato non esiste. Assicurati che non sia stato eliminato o che non abbia cambaito la sua posizione sul nostro server."
  }
}).catch((error) => {
  //Errore
});
}

function noinfomess(){
  document.getElementById('infomessdiv').style.display = 'none'
}


 auth.onAuthStateChanged(function(user){
   if(user){
     console.log("Attivo!")
     setTimeout(verifica , 100)
     setTimeout(mostraononmostrapallino , 1500)
     const dbRef = firebase.database().ref();
     dbRef.child("Utenti").child(user.uid).get().then((snn) => {
       var utente = snn.val();
     firebase.database().ref("Messaggi community").on("child_added", function (snapshot) {
       const data = snapshot.val()
       var messaggio = data.messaggio
       var datamess = data.datainvio
       var ora = data.ora
       var mittente = data.mittente
       var email = data.email
       var profiloph = data.fotoprofilo
       if(mittente === utente.Nome){
         mittente = "Tu"
       }
       var immaginemess = '<img src="' + profiloph + '" style="max-width:100px;max-height:100px; border-radius:50px;float:left;"/><center><h1 style="font-size:35px;">' + mittente + '</h1><h1 style="font-size:30px;">' + datamess + ', ore ' + ora + '</h1></center>'
       var messaggio = '<hr style="width:90%;"></hr><div class="messaggi"><div class="titolidiv" data-id="' + snapshot.key + '" onclick="infomess(this)">' + immaginemess + '</div><h1 style="font-size:35px;">' + messaggio + '</h1></div>'
       document.getElementById("tuttiimess").innerHTML += messaggio
       document.getElementById('tuttiimess').scrollTop = 10000000000000
     });
   });
     var dataattuale = new Date();
     oraattuale = dataattuale.getHours();
     var tiposaluto
     if(oraattuale > 5 && oraattuale <= 12){
       tiposaluto = "Buongiorno"
     }else if(oraattuale > 12 && oraattuale < 18){
       tiposaluto = "Buon pomeriggio"
     }else if(oraattuale >= 18 && oraattuale <= 23){
       tiposaluto = "Buona sera"
     }else{
       tiposaluto = "Ciao,"
     }
     var user = firebase.auth().currentUser;
dbRef.child("Utenti").child(user.uid).get().then((snapshot) => {
  if (snapshot.exists()) {
    console.log(snapshot.val());
    var utente = snapshot.val()
    document.getElementById("saluta").innerHTML = tiposaluto + ", " + utente.Nome
    document.getElementById("saluta").style.display = "none"
    if(utente.Genere === "Maschio"){
      document.getElementById("saluto2").innerHTML = "Benvenuto nella seconda versione del sito Meteo Marco"
    }else if(utente.Genere === "Femmina"){
      document.getElementById("saluto2").innerHTML = "Benvenuta nella seconda versione del sito Meteo Marco"
    }
    document.getElementById("saluto2").style.display = "none"
  } else {
    document.getElementById("saluta").innerHTML = tiposaluto
  }
}).catch((error) => {
  //document.getElementById("saluta").innerHTML = tiposaluto
});
     document.getElementById("saluta").innerHTML =

dbRef.child("Utenti").child(user.uid).get().then(function (snapshot) {
       var abbonato = snapshot.val().Abbonamento
        if(abbonato === "Attivo") {

            document.getElementById("serratura").innerHTML = "lock_open"
            document.getElementById("testomacchinascrivi2").style.display = "none"
            document.getElementById("testomacchinascrivi").style.display = "none"
            document.getElementById("copri").style.background = "gray"
            var total = document.getElementById("totale")
            total.innerHTML = "<img src='https://lh3.googleusercontent.com/pw/AM-JKLU5o18ZiaGNxX1ceX394jCHFofPC7XlplfrwTG18Jeo_7Ca-ISK0rTqkROh9fpRftmrCVMK4rUB-TKcie2wzjL0cti7TMEhduPusHYN0fDvfVFe4cED6jtkcq8p_RFa1xR1ZGM0WnSbPe8PW7_WnlJm=s903-no?authuser=0' style='width: 30%'></img><br><h1>Scorri in qualsiasi direzione per sbloccare</h1>"
            total.innerHTML += "<center><div id='scorri'></div></center>"
            var scorri = document.getElementById("scorri")
           scorri.addEventListener('touchstart', e => {
              console.log("Partito")
          })
          scorri.addEventListener('touchend', e => {
            console.log("Terminato")
            document.getElementById("copri").style.display = "none"
            document.getElementById("dati").style.display = "none"
            document.getElementById("community").style.display = "none"
            //sbloccato


            $("#previsioni").css({fontSize: 20})

           const dbRef = firebase.database().ref();
           dbRef.child("Utenti").child(user.uid).child("Impostazioni").get().then((snapshot) => {
             if (snapshot.exists()) {
               var impostazioni = snapshot.val();
               console.log("Salvato sul cloud: " + impostazioni.primaimpostazione)
               if(impostazioni.primaimpostazione === "On"){
                 setTimeout(function(){
                    $("#saluta").fadeIn(1000)
                    setTimeout(function(){
                      $("#saluta").animate({
                        fontSize: "35px"
                      })
                      setTimeout(function(){
                        $("#saluto2").fadeIn(1000)
                        setTimeout(function(){
                          $("#saluto2").animate({
                            fontSize: "35px"
                          }, function(){
                            $("#introimg").fadeIn(1000)
                            setTimeout(function(){
                              $("#saluta").fadeOut(1000)
                              $("#saluto2").fadeOut(1000)
                               setTimeout(previsioni , 1000)
                               //abilitapulsanti
                               document.getElementsByClassName("pulsantiera")[0].disabled = false
                               document.getElementsByClassName("pulsantiera")[1].disabled = false
                               document.getElementsByClassName("pulsantiera")[2].disabled = false
                              document.getElementsByClassName("pulsantiera")[3].disabled = false
                            }, 2000)
                          })
                        }, 4000)
                      },500)
                    }, 4000)
                  }, 1000)
               }else{
                 setTimeout(previsioni , 1000)
               }
}
})
        });
        scorri.addEventListener('touchmove', e => {
          console.log("mosso")
      });

        }else{
          console.log("ll")
          document.getElementById("dati").style.display = "none"
          document.getElementById("community").style.display = "none"
          document.getElementById("display").style.display = "none"
          document.getElementById("comprameteomarco").style.display = "block"
          document.getElementById("copri").style.display = "none"
          document.getElementsByClassName("pulsantiera")[0].disabled = "true"
          document.getElementsByClassName("pulsantiera")[1].disabled = "true"
          document.getElementsByClassName("pulsantiera")[2].disabled = "true"
          document.getElementsByClassName("pulsantiera")[3].disabled = "true"
          document.getElementsByClassName("pulsantiera")[4].disabled = "true"
        }
     })

   }else{
    window.location.href = "accedi.html";
   }
 });

 $(".pulsantiera").click(function(){
   console.log("ha cliccato!")
   $(".pulsantiera").css({fontSize: "12px"})
   var questoelemento = $(this)
   questoelemento.css({fontSize: 20})

 })

function previsioni(){
  $("#titoloprevisioni").css("left","-250px")
  $("#testoprevisioni").css("left","-250px")
  $("#info").css("left","-250px")
  $("#titoloprevisioni").css("opacity","0.5")
  $("#testoprevisioni").css("opacity","0.5")
  $("#previsioniimg").attr("src", "menumeteomarco/descriptionselect.svg")
  $("#datiimg").attr("src", "menumeteomarco/pollnoselect.svg")
  $("#communityimg").attr("src", "menumeteomarco/forumnoselect.svg")
  $("#postimg").attr("src", "menumeteomarco/articlenoselect.svg")
  $("#impostazioniimg").attr("src", "menumeteomarco/settingnoselect.svg")
  //avvia le previsioni
  var titolo = document.getElementById("titoloprevisioni")
  var testot = document.getElementById("testoprevisioni")
  mostraononmostrapallinocomm()
  titolo.innerHTML = " "
testot.innerHTML = " "
document.getElementById("previsionitutti").innerHTML = " "
document.getElementById("orainora").innerHTML = " "
document.getElementById("ascoltavic").style.display = "block"
  var testo = firebase.database().ref('Previsioni/Condizioni generali');
testo.on('value', (snapshot) => {
  const data = snapshot.val();
  titolo.innerHTML = "<h1>" + data.titolo + "</h1>"
  $("#titoloprevisioni").animate({
    left: 15,
    opacity: 1
  }, 1500)
  if(data.avvisi){
    testot.innerHTML = "<h2>" + data.testo + "</h2><br><h3><img src='menumeteomarco/info.svg' width='35px'></img>&nbsp;<strong>" + data.avvisi + "</strong></h3>"
    $("#testoprevisioni").animate({
      left: 15,
      opacity: 1
    }, 1500)

  }else{
    testot.innerHTML = "<h2>" + data.testo + "</h2>"
    $("#testoprevisioni").animate({
      left: 15,
      opacity: 1
    }, 1500)

  }

  var user = firebase.auth().currentUser;
  const dbRef = firebase.database().ref();

  //Spazio per avvisi personali
  dbRef.child("Utenti").child(user.uid).get().then((snapshot) => {
      var utente = snapshot.val();
      var scadenza = new Date(utente.Scadenza)
      console.log("Scadenza:" + scadenza)
      var giornoscadenza = scadenza.getDate()
      var oggi = new Date();
      var giornooggi = oggi.getDate()
      //differenza tra scadenza e Oggi
      var differenza = giornoscadenza - giornooggi
      console.log("Differenza: " + differenza)

      if(differenza === 1){
        console.log("mancauno")
        testot.innerHTML += "<h3 style='color:#ff7b00'><span class='material-icons md-36'>event</span> Il tuo abbonamento scadr&agrave; domani alle " + scadenza.getHours() + ":" + scadenza.getMinutes() + "<strong></strong></h3>"
      }
    if(differenza === 0){
      console.log("mancazero")
      testot.innerHTML += "<h3 style='color:#b50000'><span class='material-icons md-36'>today</span> Il tuo abbonamento scadr&agrave; oggi alle " + scadenza.getHours() + ":" + scadenza.getMinutes() + "<strong></strong></h3>"
    }
    if(differenza<0){
      testot.innerHTML += "<h3 style='color:#137a01'><span class='material-icons md-36'>check_circle_outline</span> Il tuo abbonamento scadr&agrave; il " + scadenza.getDate() + " del prossimo mese alle " + scadenza.getHours() + ":" + scadenza.getMinutes() + "<strong></strong></h3>"
    }
    if(differenza>1){
      testot.innerHTML += "<h3 style='color:#137a01'><span class='material-icons md-36'>event</span> Il tuo abbonamento scadr&agrave; tra " + differenza + " giorni<strong></strong></h3>"

    }

  })


  var attd = data.attendibilità

  dbRef.child("Utenti").child(user.uid).child("Impostazioni").get().then((snapshot) => {
    if (snapshot.exists()) {
      var impostazioni = snapshot.val();
      console.log("Salvato sul cloud: " + impostazioni.secondaimpostazione)
      if(impostazioni.secondaimpostazione === "On"){
          document.getElementById("attendibilita").innerHTML = "<h2>Attendibilit&agrave;: " + attd + "</h2>"
            $("#ascolta").css({"margin-left":"325px"})
            $("#ascoltavic").animate({
              width: "400px"
            })
      }else{
        document.getElementById("attendibilita").innerHTML = " "
        $("#ascoltavic").animate({
          width: "90px"
        })

        document.getElementById("attendibilita").innerHTML = '<button id="ascolta" onclick="ascolta()"><span class="material-icons md-50">hearing</span></button>'
        $("#ascolta").css({"margin-left":"5px"})
      }

    }
})
  switch(data.simbolo){
    case "Soleggiato":
      $("#presentazioneimg").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
      break;
    case "Parzialmente soleggiato":
      $("#presentazioneimg").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
      break;
      case "Nuvoloso":
        $("#presentazioneimg").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png");
        break;
      case "Piovoso":
        $("#presentazioneimg").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
        break;
      case "Temporali":
        $("#presentazioneimg").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
        break;
  }
});
const dbRef = firebase.database().ref();
dbRef.child("Previsioni/Temperature").get().then((snapshot) => {
  if (snapshot.exists()) {
    console.log(snapshot.val());
    var condgen = "<h2 style='font-size: 35px;'>Domani</h2>"
    var maxmin = "<h2 style='margin-left: 10px;'>Min: " + snapshot.val().minima + "<br>Max: " + snapshot.val().massima + "</h2>"
    document.getElementById("previsionitutti").innerHTML += '<div id="giorno" class="altrigiorni"><img src="" width="75px" id="giornoimg" style="float: left;"></img>' + condgen + maxmin + '</div>'


    dbRef.child("Previsioni/Condizioni generali").get().then((snapshot) => {
      if (snapshot.exists()) {
        console.log(snapshot.val());
        switch(snapshot.val().simbolo){
          case "Soleggiato":
            $("#giornoimg").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
            document.getElementById("immaginesenzazione").style.backgroundImage = "url('Immaginisfondodiv/soleggiato.png')"
            break;
          case "Parzialmente soleggiato":
            $("#giornoimg").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
            document.getElementById("immaginesenzazione").style.backgroundImage = "url('Immaginisfondodiv/Parzialmentesoleggiato.png')"
            break;
            case "Nuvoloso":
              $("#giornoimg").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png");
                document.getElementById("immaginesenzazione").style.backgroundImage = "url('Immaginisfondodiv/Nuvoloso.png')"
              break;
            case "Piovoso":
              $("#giornoimg").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
              document.getElementById("immaginesenzazione").style.backgroundImage = "url('Immaginisfondodiv/Pioggia.png')"
              break;
            case "Temporali":
              $("#giornoimg").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
              document.getElementById("immaginesenzazione").style.backgroundImage = "url('Immaginisfondodiv/Temporali.png')"
              break;
        }

      } else {
        console.log("No data available");
      }
    }).catch((error) => {
      console.error(error);
    });


  } else {
    console.log("No data available");
  }
}).catch((error) => {
  console.error(error);
});

const primo = firebase.database().ref();
primo.child("Previsioni/giornodopo1").get().then((snapshot) => {
  if (snapshot.exists()) {
    console.log(snapshot.val());
    var condgen = "<h2 style='font-size: 35px;'>" + snapshot.val().giorno + "</h2>"
    var maxmin = "<h2 style='margin-left: 10px;'>Min: " + snapshot.val().minima + "<br>Max: " + snapshot.val().massima + "</h2>"
    document.getElementById("previsionitutti").innerHTML += '<div id="giorno1" class="altrigiorni"><img src="" width="75px" id="giorno1img" style="float: left;"></img>' + condgen + maxmin + '</div>'

    switch(snapshot.val().simbolo){
      case "Soleggiato":
        $("#giorno1img").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
        break;
      case "Parzialmente soleggiato":
        $("#giorno1img").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
        break;
        case "Nuvoloso":
          $("#giorno1img").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png");
          break;
        case "Piovoso":
          $("#giorno1img").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
          break;
        case "Temporali":
          $("#giorno1img").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
          break;
    }

  } else {
    console.log("No data available");
  }
}).catch((error) => {
  console.error(error);
});


const secondog = firebase.database().ref();
secondog.child("Previsioni/giornodopo2").get().then((snapshot) => {
  if (snapshot.exists()) {
    console.log(snapshot.val());
    var condgen = "<h2 style='font-size: 35px;'>" + snapshot.val().giorno + "</h2>"
    var maxmin = "<h2 style='margin-left: 10px;'>Min: " + snapshot.val().minima + "<br>Max: " + snapshot.val().massima + "</h2>"
    document.getElementById("previsionitutti").innerHTML += '<div id="giorno1" class="altrigiorni"><img src="" width="75px" id="giorno2img" style="float: left;"></img>' + condgen + maxmin + '</div>'

    switch(snapshot.val().simbolo){
      case "Soleggiato":
        $("#giorno2img").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
        break;
      case "Parzialmente soleggiato":
        $("#giorno2img").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
        break;
        case "Nuvoloso":
          $("#giorno2img").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png");
          break;
        case "Piovoso":
          $("#giorno2img").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
          break;
        case "Temporali":
          $("#giorno2img").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
          break;
    }

  } else {
    console.log("No data available");
  }
}).catch((error) => {
  console.error(error);
});

dbRef.child("Previsioni/Orainora").get().then((snapshot) => {
  if (snapshot.exists()) {
    var dati = snapshot.val();


    document.getElementById("orainora").innerHTML += "<div class='oraino'><center><h3>Dalle 03:00 alle 06:00</h3><img src='' id='da3a6'></img></center></div>"
    switch(snapshot.val().da3a6){
      case "Soleggiato":
        $("#da3a6").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
        break;
      case "Parzialmente soleggiato":
        $("#da3a6").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
        break;
        case "Nuvoloso":
          $("#da3a6").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png");
          break;
        case "Piovoso":
          $("#da3a6").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
          break;
        case "Temporali":
          $("#da3a6").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
          break;
    }

    document.getElementById("orainora").innerHTML += "<div class='oraino'><center><h3>Dalle 06:00 alle 09:00</h3><img src='' id='da6a9'></img></center></div>"
    switch(snapshot.val().da6a9){
      case "Soleggiato":
        $("#da6a9").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
        break;
      case "Parzialmente soleggiato":
        $("#da6a9").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
        break;
        case "Nuvoloso":
          $("#da6a9").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png");
          break;
        case "Piovoso":
          $("#da6a9").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
          break;
        case "Temporali":
          $("#da6a9").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
          break;
    }

    document.getElementById("orainora").innerHTML += "<div class='oraino'><center><h3>Dalle 09:00 alle 12:00</h3><img src='' id='da9a12'></img></center></div>"
    switch(snapshot.val().da9a12){
      case "Soleggiato":
        $("#da9a12").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
        break;
      case "Parzialmente soleggiato":
        $("#da9a12").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
        break;
        case "Nuvoloso":
          $("#da9a12").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png");
          break;
        case "Piovoso":
          $("#da9a12").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
          break;
        case "Temporali":
          $("#da9a12").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
          break;
    }

    document.getElementById("orainora").innerHTML += "<div class='oraino'><center><h3>Dalle 12:00 alle 15:00</h3><img src='' id='da12a15'></img></center></div>"
    switch(snapshot.val().da12a15){
      case "Soleggiato":
        $("#da12a15").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
        break;
      case "Parzialmente soleggiato":
        $("#da12a15").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
        break;
        case "Nuvoloso":
          $("#da12a15").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png");
          break;
        case "Piovoso":
          $("#da12a15").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
          break;
        case "Temporali":
          $("#da12a15").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
          break;
    }

    document.getElementById("orainora").innerHTML += "<div class='oraino'><center><h3>Dalle 15:00 alle 18:00</h3><img src='' id='da15a18'></img></center></div>"
    switch(snapshot.val().da15a18){
      case "Soleggiato":
        $("#da15a18").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
        break;
      case "Parzialmente soleggiato":
        $("#da15a18").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
        break;
        case "Nuvoloso":
          $("#da15a18").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png");
          break;
        case "Piovoso":
          $("#da15a18").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
          break;
        case "Temporali":
          $("#da15a18").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
          break;
    }

    document.getElementById("orainora").innerHTML += "<div class='oraino'><center><h3>Dalle 18:00 alle 21:00</h3><img src='' id='da18a21'></img></center></div>"
    switch(snapshot.val().da18a21){
      case "Soleggiato":
        $("#da18a21").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
        break;
      case "Parzialmente soleggiato":
        $("#da18a21").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
        break;
        case "Nuvoloso":
          $("#da18a21").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png");
          break;
        case "Piovoso":
          $("#da18a21").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
          break;
        case "Temporali":
          $("#da18a21").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
          break;
    }

    document.getElementById("orainora").innerHTML += "<div class='oraino'><center><h3>Dalle 21:00 alle 24:00</h3><img src='' id='da21a24'></img></center></div>"
    switch(snapshot.val().da21a24){
      case "Soleggiato":
        $("#da21a24").attr("src","https://ssl.gstatic.com/onebox/weather/48/sunny.png");
        break;
      case "Parzialmente soleggiato":
        $("#da21a24").attr("src","https://ssl.gstatic.com/onebox/weather/48/partly_cloudy.png");
        break;
        case "Nuvoloso":
          $("#da21a24").attr("src","https://ssl.gstatic.com/onebox/weather/64/cloudy.png");
          break;
        case "Piovoso":
          $("#da21a24").attr("src","https://ssl.gstatic.com/onebox/weather/48/rain_s_cloudy.png");
          break;
        case "Temporali":
          $("#da21a24").attr("src","https://ssl.gstatic.com/onebox/weather/48/thunderstorms.png");
          break;
    }
    $(".oraino").click(function(){
      console.log("click")
      var questo = $(this)
      //altri
      $(".oraino").animate({
        width: "11%"
      })
      $(this).animate({
        width: "18%"
      })
    })
  } else {
    console.log("No data available");
  }
}).catch((error) => {
  console.error(error);
});

document.getElementById("display").style.display = "block"
nonècommunity()
nonèdati()
nonèimpostazioni()
monèpost()
}

function ascolta(){
  var testo = firebase.database().ref('Previsioni/Condizioni generali');
  testo.on('value', (snapshot) => {
    const data = snapshot.val();
    var ascolta = data.testo
    console.log(ascolta)
    var msg = new SpeechSynthesisUtterance();
    var voices = window.speechSynthesis.getVoices();
    msg.voice = voices[10];
    msg.voiceURI = 'native'
    msg.volume = 1; // 0 to 1
    msg.rate = 0.7; // 0.1 to 10
    msg.pitch = 1; //0 to 2
    msg.text = ascolta;
    msg.lang = 'it-IT';

    speechSynthesis.speak(msg);
  })
}
function nonèprevisioni(){
  document.getElementById("display").style.display = "none"
}
function nonèdati(){
  document.getElementById("dati").style.display = "none"
}
function nonècommunity(){
  document.getElementById("community").style.display = "none"
}
function nonèimpostazioni(){
  console.log("non è impostazioni")
}
function monèpost(){
    document.getElementById("news").style.display = "none"

}

function dati(){
  nonèprevisioni()
  nonècommunity()
  nonèimpostazioni()
  monèpost()
  mostraononmostrapallinocomm()
  document.getElementById("dati").style.display = "block"
  $("#previsioniimg").attr("src", "menumeteomarco/descriptionnoselect.svg")
  $("#datiimg").attr("src", "menumeteomarco/pollselect.svg")
  $("#communityimg").attr("src", "menumeteomarco/forumnoselect.svg")
  $("#postimg").attr("src", "menumeteomarco/articlenoselect.svg")
  $("#impostazioniimg").attr("src", "menumeteomarco/settingnoselect.svg")
}
function community(){
  nonèprevisioni()
  nonèdati()
  nonèimpostazioni()
  monèpost()
  document.getElementById("community").style.display = "block"
    document.getElementById('tuttiimess').scrollTop = 10000000000000
  $("#previsioniimg").attr("src", "menumeteomarco/descriptionnoselect.svg")
  $("#datiimg").attr("src", "menumeteomarco/pollnoselect.svg")
  $("#communityimg").attr("src", "menumeteomarco/forumselect.svg")
  $("#postimg").attr("src", "menumeteomarco/articlenoselect.svg")
  $("#impostazioniimg").attr("src", "menumeteomarco/settingnoselect.svg")
  registracomm();
}
function post(){
  nonèprevisioni()
  nonèdati()
  nonècommunity()
  nonèimpostazioni()
  mostraononmostrapallinocomm()
    document.getElementById("pallinonews").style.display = "none"
//  $("#previsioni").click(function(){
      var user = firebase.auth().currentUser;
    var contaquantipost = document.getElementsByClassName("notizia").length;
    console.log(contaquantipost)
    //fa il back-up per il salvataggio
    firebase.database().ref("Utenti/" + user.uid + '/Notifiche').update({
      notificapost: contaquantipost
 });
  //})
  document.getElementById("news").style.display = "block"
  $("#previsioniimg").attr("src", "menumeteomarco/descriptionnoselect.svg")
  $("#datiimg").attr("src", "menumeteomarco/pollnoselect.svg")
  $("#communityimg").attr("src", "menumeteomarco/forumnoselect.svg")
  $("#postimg").attr("src", "menumeteomarco/articleselect.svg")
  $("#impostazioniimg").attr("src", "menumeteomarco/settingnoselect.svg")
}
function impostazioni(){
  nonèprevisioni()
  nonèdati()
  nonècommunity()
  monèpost()
  mostraononmostrapallinocomm()
 window.location = "gestioneaccount.html";
  $("#previsioniimg").attr("src", "menumeteomarco/descriptionnoselect.svg")
  $("#datiimg").attr("src", "menumeteomarco/pollnoselect.svg")
  $("#communityimg").attr("src", "menumeteomarco/forumnoselect.svg")
  $("#postimg").attr("src", "menumeteomarco/articlenoselect.svg")
  $("#impostazioniimg").attr("src", "menumeteomarco/settingselect.svg")
}

function modificanome(){
  var user = firebase.auth().currentUser;
  var nome = prompt("Inserisci il tuo nuovo nome:");
 if (nome == null || nome == ""){

 }else{
   firebase.database().ref('Utenti/' + user.uid).update({
     Nome: nome
   });
 }
}
function incasoon(){
  one.classList.toggle("inactive1");
}

//Caricamento non-richiesto news

var user = firebase.auth().currentUser;
firebase.database().ref("Previsioni/Notizie").on("child_added", function (snapshot) {
 const notizia = snapshot.val();
 console.log(snapshot.key)
 document.getElementById("nonews").innerHTML = ""

var logoeinfo
console.log(notizia.Tipo)
 if(notizia.Tipo === "Allerta"){
   logoeinfo = '<h2 style="float: left;">&nbsp;&nbsp;Allerta</h2><h2 style="text-align: right; padding-right:30px;">' + notizia.Data + '</h2><span class="material-icons md-85 red">warning</span>'
 }
  if(notizia.Tipo === "Info"){
    logoeinfo = '<h2 style="float: left;">&nbsp;&nbsp;Informazione</h2><h2 style="text-align: right; padding-right:30px;">' + notizia.Data + '</h2><span class="material-icons md-85 gray">info</span>'
  }
  if(notizia.Tipo === "Tendenza"){
    logoeinfo = '<h2 style="float: left;">&nbsp;&nbsp;Tendenza</h2><h2 style="text-align: right; padding-right:30px;">' + notizia.Data + '</h2><span class="material-icons md-85 green">insights</span>'
  }

 var preparadiv = "<div class='notizia'><br>" + logoeinfo + "<h1 style='font-size: 53px;'>" + notizia.Titolo + "</h1><h1 style='font-size: 44px;'>" + notizia.Testo + "</h1><button class='like'><span class='material-icons md-50'>thumb_up</span></button></div><br><br>"

 document.getElementById("mostranews").innerHTML += preparadiv
 $(".like").click(function (){
   console.log("okk")
   this.style.color = "#0055ff"
 })

})

//Invia dati al server per push di community, function() a parte
  function registracomm(){
    var user = firebase.auth().currentUser;

    var tuttiimess = document.getElementsByClassName("messaggi");
    var invia = tuttiimess.length
    console.log(invia);
    firebase.database().ref('Utenti/' + user.uid + '/Notifiche').update({
    notificacommunity: invia
  });
  var timerstop = setTimeout(registracomm , 1000)
  $(".pulsantiera:not(#communityyy)").click(function(){
    console.log("eeeeee")
    clearTimeout(timerstop)
  })
  }

function mostraononmostrapallinocomm(){
  var user = firebase.auth().currentUser;
  const dbRef = firebase.database().ref();
dbRef.get().then((snapshot) => {
  var totale = snapshot.val().Totalemessaggicommunity
  dbRef.child("Utenti").child(user.uid).child("Notifiche").get().then((snapshot) => {
    var letti = snapshot.val().notificacommunity
    var sottrai = totale-letti
    //ragionamento
    if(sottrai === 0){
      //Tutto a posto: tutto letto
      document.getElementById("pallinocommunity").style.display = "none"
      console.log("A posto");
    }else if(sottrai > 0){
      //Hai dei nuovi messaggi
      console.log("Da leggere");
      document.getElementById("pallinocommunity").style.display = "block"
    }else if(sottrai < 0){
      console.log("Negativo");
      firebase.database().ref('Utenti/' + user.uid + '/Notifiche').update({
      notificacommunity: 0
    });
    document.getElementById("pallinocommunity").style.display = "none"
    }
  });
});


var timerstop = setTimeout(mostraononmostrapallinocomm , 1000)
$("#communityyy").click(function(){
  console.log("eeeeee")
  clearTimeout(timerstop)
})
}

//Compra Meteo marco
function ricarica(){
  window.location.reload();
}
function acquistaunasett(){
  var user = firebase.auth().currentUser;
  const dbRef = firebase.database().ref();
dbRef.child("Utenti").child(user.uid).get().then((snapshot) => {
  var valori = snapshot.val();
  var soldiattuali = valori.Soldi
  if(soldiattuali < 0.65){
    //Non ha soldi
    document.getElementsByClassName("motivimm")[0].style.display = "none"
    document.getElementsByClassName("motivimm")[1].style.display = "none"
    document.getElementsByClassName("motivimm")[2].style.display = "none"
    document.getElementsByClassName("motivimm")[3].style.display = "none"
    document.getElementsByClassName("motivimm")[4].style.display = "none"
    document.getElementsByClassName("motivimm")[5].style.display = "none"

    document.getElementById("compradopo").innerHTML += '<br><br><br><br><br><br><span class="material-icons md-150 red">error_outline</span><h1>Non hai soldi nell\'account</h1><h2 style="font-size: 37px;">Sembra che nel tuo account non siano memorizzati i soldi necessari per l\'acquisto. Se vuoi ricaricare il portafoglio recati da Marco con i contanti che desideri acquistare.</h2>'

  }else{
  var d = new Date();
  dataduen = d.getDate();

  var piusette = new Date()
  piusette.setDate(dataduen + 7)
  var invia = "" + piusette
  console.log(piusette)

  var soldidainviare = soldiattuali - 0.65
  var sol = soldidainviare.toFixed(2)
  var inviaa = Number(sol);
  firebase.database().ref('Utenti/' + user.uid).update({
    Abbonamento: "Attivo",
    Soldi: inviaa,
    Scadenza: invia
  }).then(function(){
    //Fatto
    console.log("Fatto")
    var giorno = piusette.getDate()
    var mese = piusette.getMonth()
    var anno = piusette.getFullYear()
    var ore = piusette.getHours()
    var minuti = piusette.getMinutes()
    document.getElementsByClassName("motivimm")[0].style.display = "none"
    document.getElementsByClassName("motivimm")[1].style.display = "none"
    document.getElementsByClassName("motivimm")[2].style.display = "none"
    document.getElementsByClassName("motivimm")[3].style.display = "none"
    document.getElementsByClassName("motivimm")[4].style.display = "none"
    document.getElementsByClassName("motivimm")[5].style.display = "none"
    document.getElementById("compradopo").innerHTML = '<br><br><span class="material-icons green md-150">check_circle_outline</span><h1>Acquisto effettuato!</h1><h2 style="font-size: 37px;">Ora goditi tutti i vantaggi di Meteo Marco! Li puoi trovare tutti in questo sito.</h2><h1>Dettagli: </h1><h2>Data e ora di scadenza dell\'abbonamento: ' + ore + ':' + minuti + '  '+ giorno + '/' + mese + '/' + anno + '<br>Costo spesa: &euro; 0,65 <br> Articolo acquistato: Meteo Marco Premium Plus - 1 settimana</h2><h1>Denaro ora meomorizzato: &euro;' + soldidainviare + '</h1><br><br><center><button style="background-color: #0dd406; border: 0px; width: 35%; height: 200px; border-radius: 15px; float: left;"><h1 style="font-family: "Ubuntu", sans-serif;" onclick="ricarica()">Accedi a Meteo Marco</h1></button></center>'
    document.getElementById("compradopo").innerHTML += '<br><br>'

    var adesso = new Date();
    var giorno = adesso.getDate();
    var mese = adesso.getMonth();
    var anno = adesso.getFullYear();
    var minuto = adesso.getMinutes();
    var oraa = adesso.getHours();
    mese++

    var data = giorno + "/" + mese + "/" + anno
    var ora = oraa + ":" + minuto

    var elencoCaratteri="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";
   var minimoCaratteri=8;
   var massimoCaratteri=8;
   var differenzaCaratteri=massimoCaratteri-minimoCaratteri;
   var lunghezza=Math.round((Math.random()*differenzaCaratteri)+minimoCaratteri);
   var incremento=0;
   var password="";
   while(incremento<lunghezza){
      password+=elencoCaratteri.charAt(Math.round(Math.random()*elencoCaratteri.length));
      incremento++;
   }

    firebase.database().ref("Utenti/" + user.uid + "/Cronologiapagamenti").push().set({
       "data": data,
       "ora": ora,
       "totale": "0,65",
       "articolo": "Meteo Marco Premium Plus- 1 Settimana",
       "id": password
    });
  }).catch((error) =>{
    document.getElementsByClassName("motivimm")[0].style.display = "none"
    document.getElementsByClassName("motivimm")[1].style.display = "none"
    document.getElementsByClassName("motivimm")[2].style.display = "none"
    document.getElementsByClassName("motivimm")[3].style.display = "none"
    document.getElementsByClassName("motivimm")[4].style.display = "none"
    document.getElementsByClassName("motivimm")[5].style.display = "none"
    console.error(error)
    document.getElementById("compradopo").innerHTML += '<br><br><span class="material-icons md-150 red">error_outline</span><h1>Acquisto non riuscito</h1><h2 style="font-size: 37px;">Si &egrave; verificato un errore durante la memorizzazione dei dati sull\'account. Non abbiamo attivato l\'abbonamento ne tolto denaro al tuo account.</h2><h2>Specifiche errore:<br>' + error + '</h2>'

  })
}
})

}
function acquistaduesett(){
  var user = firebase.auth().currentUser;
  const dbRef = firebase.database().ref();
dbRef.child("Utenti").child(user.uid).get().then((snapshot) => {
  var valori = snapshot.val();
  var soldiattuali = valori.Soldi
  if(soldiattuali < 1.3){
    //Non ha soldi
    document.getElementsByClassName("motivimm")[0].style.display = "none"
    document.getElementsByClassName("motivimm")[1].style.display = "none"
    document.getElementsByClassName("motivimm")[2].style.display = "none"
    document.getElementsByClassName("motivimm")[3].style.display = "none"
    document.getElementsByClassName("motivimm")[4].style.display = "none"
    document.getElementsByClassName("motivimm")[5].style.display = "none"

    document.getElementById("compradopo").innerHTML += '<br><br><br><br><br><br><span class="material-icons md-150 red">error_outline</span><h1>Non hai soldi nell\'account</h1><h2 style="font-size: 37px;">Sembra che nel tuo account non siano memorizzati i soldi necessari per l\'acquisto. Se vuoi ricaricare il portafoglio recati da Marco con i contanti che desideri acquistare.</h2>'

  }else{
  var d = new Date();
  dataduen = d.getDate();

  var piusette = new Date()
  piusette.setDate(dataduen + 14)
  var invia = "" + piusette
  console.log(piusette)

  var soldidainviare = soldiattuali - 1.3
  var sol = soldidainviare.toFixed(2)
  var inviaaa = Number(sol);
  firebase.database().ref('Utenti/' + user.uid).update({
    Abbonamento: "Attivo",
    Soldi: inviaaa,
    Scadenza: invia
  }).then(function(){
    //Fatto
    console.log("Fatto")
    var giorno = piusette.getDate()
    var mese = piusette.getMonth()
    var anno = piusette.getFullYear()
    var ore = piusette.getHours()
    var minuti = piusette.getMinutes()
    document.getElementsByClassName("motivimm")[0].style.display = "none"
    document.getElementsByClassName("motivimm")[1].style.display = "none"
    document.getElementsByClassName("motivimm")[2].style.display = "none"
    document.getElementsByClassName("motivimm")[3].style.display = "none"
    document.getElementsByClassName("motivimm")[4].style.display = "none"
    document.getElementsByClassName("motivimm")[5].style.display = "none"
    document.getElementById("compradopo").innerHTML = '<br><br><span class="material-icons green md-150">check_circle_outline</span><h1>Acquisto effettuato!</h1><h2 style="font-size: 37px;">Ora goditi tutti i vantaggi di Meteo Marco! Li puoi trovare tutti in questo sito.</h2><h1>Dettagli: </h1><h2>Data e ora di scadenza dell\'abbonamento: ' + ore + ':' + minuti + '  '+ giorno + '/' + mese + '/' + anno + '<br>Costo spesa: &euro; 1,30 <br> Articolo acquistato: Meteo Marco Premium Plus - 2 settimane</h2><br><h1>Denaro ora meomorizzato: &euro;' + soldidainviare + '</h1><br><center><button style="background-color: #0dd406; border: 0px; width: 35%; height: 200px; border-radius: 15px; float: left;"><h1 style="font-family: "Ubuntu", sans-serif;" onclick="ricarica()">Accedi a Meteo Marco</h1></button></center>'
    document.getElementById("compradopo").innerHTML += '<br><br>'
    var adesso = new Date();
    var giorno = adesso.getDate();
    var mese = adesso.getMonth();
    var anno = adesso.getFullYear();
    var minuto = adesso.getMinutes();
    var oraa = adesso.getHours();
    mese++

    var data = giorno + "/" + mese + "/" + anno
    var ora = oraa + ":" + minuto

    var elencoCaratteri="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";
   var minimoCaratteri=8;
   var massimoCaratteri=8;
   var differenzaCaratteri=massimoCaratteri-minimoCaratteri;
   var lunghezza=Math.round((Math.random()*differenzaCaratteri)+minimoCaratteri);
   var incremento=0;
   var password="";
   while(incremento<lunghezza){
      password+=elencoCaratteri.charAt(Math.round(Math.random()*elencoCaratteri.length));
      incremento++;
   }

    firebase.database().ref("Utenti/" + user.uid + "/Cronologiapagamenti").push().set({
       "data": data,
       "ora": ora,
       "totale": "1,30",
       "articolo": "Meteo Marco Premium Plus- 2 Settimane",
       "id": password
    });
  }).catch((error) =>{
    document.getElementsByClassName("motivimm")[0].style.display = "none"
    document.getElementsByClassName("motivimm")[1].style.display = "none"
    document.getElementsByClassName("motivimm")[2].style.display = "none"
    document.getElementsByClassName("motivimm")[3].style.display = "none"
    document.getElementsByClassName("motivimm")[4].style.display = "none"
    document.getElementsByClassName("motivimm")[5].style.display = "none"
    console.error(error)
    document.getElementById("compradopo").innerHTML += '<br><br><span class="material-icons md-150 red">error_outline</span><h1>Acquisto non riuscito</h1><h2 style="font-size: 37px;">Si &egrave; verificato un errore durante la memorizzazione dei dati sull\'account. Non abbiamo attivato l\'abbonamento ne tolto denaro al tuo account.</h2><h2>Specifiche errore:<br>' + error + '</h2>'

  })
}
})
}

function mostraononmostrapallino(){
    var user = firebase.auth().currentUser;
  const dbRef = firebase.database().ref();
  dbRef.child("Utenti").child(user.uid).child("Notifiche").get().then((snapshot) => {
    if (snapshot.exists()) {
     var not = snapshot.val()

     dbRef.child("Previsioni").get().then((snapshot) => {
       if (snapshot.exists()) {
        var nume = snapshot.val()
        var numeronewstotali = nume.Numeropost
        var sottrai = numeronewstotali - not.notificapost
        console.log("Numero di post totali: " + numeronewstotali);
        console.log("Numero di post letti: " + not.notificapost);
        console.log("Numero di post sott: " + sottrai);
        console.log(typeof sottrai)
        if(sottrai === 0){
          console.log("lette tutte");
          document.getElementById("pallinonews").style.display = "none"
        }else if(sottrai > 0){
          console.log("Ancora da leggere");
          document.getElementById("pallinonews").style.display = "block"
        }else{
          console.log("Se vero")
          firebase.database().ref("Utenti/" + user.uid + '/Notifiche').update({
            notificapost: 0
       });
       mostraononmostrapallino();
        }
       } else {
         console.log("No data available");
         var descrivierrore = "Non ci sono i dati necessari nell'account. Errore 1B<br>Momentaneamente non possiamo farti accedere al sito. "
         verificatoerrore(descrivierrore , error)

       }
     }).catch((error) => {
       console.error(error);
       var descrivierrore = "Si &egrave; verificato un problema nel caricamento delle informazioni secondarie. Errore 0B<br>Momentaneamente non possiamo farti accedere al sito. "
       verificatoerrore(descrivierrore , error)
     });

  }
})

}

//verifica solo la data
function verifica(){
  var user = firebase.auth().currentUser;
  const dbRef = firebase.database().ref();
dbRef.child("Utenti").child(user.uid).get().then((snapshot) => {
  if (snapshot.exists()) {
    var valori = snapshot.val();
    console.log(valori.Scadenza)
    var piusett = valori.Scadenza
    const second = 1000,
          minute = second * 60,
          hour = minute * 60,
          day = hour * 24;

    let birthday = piusett,
        countDown = new Date(birthday).getTime(),
        x = setInterval(function() {

          let now = new Date().getTime(),
              distance = countDown - now;

          //do something later when date is reached
          if (distance < 0){
            console.log('ALLARME')
            var data = new Date(birthday).getDate()
            var mese = new Date(birthday).getMonth()
            var anno = new Date(birthday).getFullYear()
            var datascad = data + "/" + mese + "/" + anno

            abbonamentoterminato();
            clearInterval(x);
          }
          //seconds
        }, 0)
  } else {
    console.log("No data available");
    var descrivierrore = "Nel nostro server non sono presenti le informazioni necessarie per accedere all'abbonamento Meteo Marco. Errore 1A.<br>Momentaneamente non possiamo farti accedere al sito. "
    verificatoerrore(descrivierrore , error)
  }
}).catch((error) => {
  console.error(error);
  var descrivierrore = "Non siamo riusciti a ricavare la tua data di scadenza dell'abbonamento. Errore 0A. <br>Momentaneamente non possiamo farti accedere al sito. "
  verificatoerrore(descrivierrore , error)
});
}

function abbonamentoterminato(){
  var user = firebase.auth().currentUser;
  const dbRef = firebase.database().ref();
dbRef.child("Utenti").child(user.uid).child("Impostazioni").get().then((snapshot) => {
  var impostazione = snapshot.val().terzaimpostazione

  if(impostazione === "On"){
    var d = new Date()
    var dataduen = d.getDate();
    var piusette = new Date()
    piusette.setDate(dataduen + 7)
    var invia = "" + piusette

dbRef.child("Utenti").child(user.uid).get().then((snapshot) => {
  var utente = snapshot.val();
  var sottrai = utente.Soldi - 0.65
  if(sottrai >= 0){
    firebase.database().ref('Utenti/' + user.uid).update({
    Soldi: sottrai
  });
  firebase.database().ref('Utenti/' + user.uid).update({
    Abbonamento: "Attivo",
    Scadenza: invia
  });
}else{
  document.getElementById("tuttopernascondere").style.display = "none"
  document.getElementById("nientesoldi").style.display = "block"
  document.getElementById("comprameteomarco").style.display = "none"
}
}).catch((error) => {
  var descrivierrore = "Non &egrave; stato possibile rinnovare automaticamente l'abbonamento. Errore 0A. <br>Momentaneamente non possiamo farti accedere al sito. "
  verificatoerrore(descrivierrore , error)
});

  }else{
    firebase.database().ref('Utenti/' + user.uid).update({
      Abbonamento: "Scaduto"
    });
    setTimeout(function(){
      document.getElementById("tuttopernascondere").style.display = "none"
    }, 100)
    document.getElementById("comprameteomarco").style.display = "block"
  }
}).catch((error) => {
  console.error(error);
  var descrivierrore = "Si &egrave; verificato un problema nel caricamento delle informazioni basi del tuo account. Esse sono basilari per il caricamento della pagina.<br>Momentaneamente non possiamo farti accedere al sito. "
  verificatoerrore(descrivierrore , error)
});

}

document.getElementById("comprameteomarco").style.display = "none"
document.getElementById("nientesoldi").style.display = "none"

function verificatoerrore(descrivierrore , error){
  //dacompletare
}
</script>

<style>
.material-icons.md-18 { font-size: 18px; }
.material-icons.md-24 { font-size: 24px; }
.material-icons.md-30 { font-size: 30px; }
.material-icons.md-36 { font-size: 36px; }
.material-icons.md-48 { font-size: 48px; }
.material-icons.md-50 { font-size: 50px; }
.material-icons.md-60 { font-size: 60px; }
.material-icons.md-75 { font-size: 75px; }
.material-icons.md-85 { font-size: 85px; }
.material-icons.md-150 { font-size: 150px; }
.material-icons.md-300 { font-size: 300px; }
.material-icons.red { color: red; }
.material-icons.yellow { color: yellow; }
.material-icons.green { color: #00b336; }
.material-icons.white { color: white; }
.material-icons.gray { color: #5e5e5e; }
.material-icons.blu { color: #0076f5; }

.pulsantiera {
  height: 100%;
  width: 19.2%;
  background: white;
  border: 2px solid white;
}

*{
  font-family: 'Open Sans', sans-serif;
}
h1{
  font-size: 42px;
}
td,th{
  border: 1px solid black;
  padding: 10px;
  font-size: 40px;
}
.h1mess{
  font-size: 25px;
}
.h1messs{
  font-size: 38px;
}
#saluta{
  margin-left: 5px;
  margin-top: 10px;
  font-size: 50px;
}
#saluto2{
  margin-top: 10px;
  font-size: 50px;
}
#copri{
  position: fixed;
  top:0px;
  right:0px;
  height: 100%;
  width: 100%;
  background-color: black;
}
#scorri{
  width: 80%;
  height: 70%;
}
#menu{
  margin-left: 0px;
  position: fixed;
  width: 100%;
  height: 150px;
  bottom: 1px;
  background-color: white;
  box-shadow: 0px 0px 0px 10px #dedede;
}

#previsionitutt {
    width: 90%;
    overflow-x: auto;
    white-space: nowrap;
}
#presentazioneimg{
  width: 75px;
  border: 2px solid gray;
  position: absolute;
  right: 10px;
  top: 350px;
  border-radius: 10px;
}
.altrigiorni{
  width: 29%;
  height: 200px;
  border: 2px solid gray;
  border-radius: 15px;
  padding-left: 10px;
  margin-left: 20px;
  display: inline-block;
}
#ascolta{
  width: 80px;
  height: 80px;
  border-radius: 40px;
  border: 2px solid #bdbdbd;
  float: right;
  position: fixed;
  top: 37.5%;
  margin-left: 325px;
  margin-right: 5px;
}
#ascoltavic{
  position: fixed;
  right: 20px;
  height: 90px;
  width: 400px;
  border-radius: 45px;
  background-color: #bdbdbd;
  top: 37.5%;
  border: 0px;
  padding-left: 15px;
  font-size: 20px;
}
#orainora{
  position: fixed;
  top: 78.5%;
  width: 100%;
  height: auto;
}
.oraino{
  margin-left: 10px;
  width: 12%;
  height: 150px;
  border: 2px solid gray;
  border-top-right-radius: 25px;
  border-bottom-left-radius: 25px;
  display: inline-block;
}
#immaginesenzazione{
  width: 100%;
  height: 20%;
  background-repeat: no-repeat;
  background-size: cover;
}
.intromessaggio{
  border-radius: 15px;
  background-color: #78a0ff;
}
.intromessaggioinviato{
  border-radius: 15px;
  background-color: #78ff7c
}

/*Switch per impostazioni */
.btn1_container {
  float: right;
  width: 120px;
  height: 63px;
  background-color: white;
  display: flex;
  position: relative;
  border: 3px solid #111;
  margin-right: 20px;
  box-shadow: -1px 3px 22px 0px rgba(0, 0, 0, 0.75);
}

/* Style 1 */
.btn1_container {
  border-radius: 35px;
}

.one {
  top: 10px;
  position: absolute;
  height: 40px;
  width: 40px;
  background-color: grey;
  display: block;
  border-radius: 30px;
  border: 2px solid red;
  background-color: rgba(280, 0, 0, 0.5);
  transition: all 0.3s ease;
}

.one {
  left: 5px;
}

.inactive1 {
  transform: translateX(calc(70px - 6px));
  border: 2px solid #10d610;
  background-color: rgba(0, 265, 0, 0.3);
}
#nuovopin{
  border-top-right-radius: 15px;
  border: 2px solid black;
}
.motivimm{
  width: 30%;
  height: auto;
  margin-left: 20px;
  float: left;
}
.notizia{
  width: 90%;
  height: auto;
  box-shadow:  10px  15px 5px #dedede,
              -10px -15px 5px #dedede,
               10px -15px 5px #dedede,
              -10px  15px 5px #dedede;
  border: 0px;
  border-radius: 30px;
  padding-bottom: 30px;
  margin-top: 30px;
}
.like{
  width: 80px;
  height: 80px;
  border-radius: 40px;
  background-color: white;
  border: 2px solid gray;
}


</style>
