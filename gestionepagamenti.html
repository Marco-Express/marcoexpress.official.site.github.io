<html>
<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
<title>Pagamenti Marco Express Ac</title>
</head>
<body onload='iniziobody()'></center>
  <center><div id="loading_screen">
    <center><p class="ltext">Errori trovati</p>
      <p class="ntext">Col nuvovo aggiornamento, abbiamo trovato dei nuovi bug. Tutti quelli trovati, li abbiamo risolti. Nonostante questo, potrebbero presentarsi altri errori gravi.<br> Se trovi qualche problema, ti chiediamo di premere il pulsante in basso a destra, ed inviare un feedback.<br>Grazie per la collaborazione.</p>
  </center>
  <br>
  <button onclick="chiudiavv()" style="width: 50%" id="chiud"><h1 id="count">Chiudi (5)</h1></button>
  <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
  <p style="font-size: 150px">&#8664;</p>
</div>
  <p class='ltext' id='intro'>Gestisci qui i tuoi pagamenti Marco Express. <br>Per maggiore sicurezza, accedi nuovamente.</p>
  <input type="text" placeholder="Email" id="email"></input><br><br>
  <input type="password" placeholder="Password" id="password"/>
  <button id="button" type="button" onclick="showPwd()">
  <img src='https://lh3.googleusercontent.com/pw/ACtC-3fsiPnrtt4QsQITPf6bt7DuGpEJAp2jiVi9HDAMd9lfL2n_zRkioGhq3ON7kNKTkDYH0U-Cg1He3jzivqsRC87hgNx3bZoE9QOE4cnWiTqKElk_I5CvicwuHro24wXBohZhEmOWC5OTgUBiULJGhc55=s24-no?authuser=0' height='40px'></img>
</button><br><br>
<button onclick="signIn()" id="signIn"><h1><b>Login</b></h1></button><br><br>
<span id='display'></span>
<h1 id='reip'>Hai dimenticato la password? Reimpostala sul sito Meteo Marco o sul sito "Il mio Account Marco Express"</h1></center>
<button onclick='feed()' id='feed'><h2 id='fte'>Lascia un Feedback!</h2></button>
<span id='barrastato'></span>
  <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyCIw0-w1C3zDjoGgVpLKsFYm2TFXqJr9yw",
  authDomain: "marco-express-d30c8.firebaseapp.com",
  projectId: "marco-express-d30c8",
  storageBucket: "marco-express-d30c8.appspot.com",
  messagingSenderId: "764621319758",
  appId: "1:764621319758:web:9390a4a994df27cda4dd1f",
  measurementId: "G-3ZK6NW0G3F"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();

function jj() {
  var ok = $("#feed")
  ok.animate({
    height: "80px",
    width: "80px"
  }, 900)
  document.getElementById('fte').innerHTML = '<img src="https://lh3.googleusercontent.com/pw/AM-JKLVbVOJs-bg9c5p-4RMYN1rU3WwYceo4sCH6vFdmujR1tz3xxcOHHNGecU4GVq8PFT8uDJ7hmTkmfHnxNOzGdLVcLT39HE-ptKkf0kkNM1SOgezDTYY5TyBPUPYkN4i0jXdn2yoAPrSNVdoS8N2o6S2z=s24-no?authuser=0" height= "39px" width="39px"></img>'
  $('#feed').css('border-radius', '40px');

}

function iniziobody() {
  document.getElementById("chiud").disabled = true;
  setTimeout(jj, 7000)
  setTimeout(uno, 1000)
  setTimeout(due, 2000)
  setTimeout(tre, 3000)
  setTimeout(quattro, 4000)
  setTimeout(fine, 5000)
  return true;
}
  function uno(){
    document.getElementById("count").innerHTML = "Chiudi (4)"
}
function due(){
  document.getElementById("count").innerHTML = "Chiudi (3)"
}
function tre(){
  document.getElementById("count").innerHTML = "Chiudi (2)"
}
function quattro(){
  document.getElementById("count").innerHTML = "Chiudi (1)"
}
function fine(){
  document.getElementById("count").innerHTML = "Chiudi"
  document.getElementById("chiud").disabled = false;
  return false;
}
function chiudiavv(){
  console.log("ok?")
  document.getElementById("loading_screen").style.display = "none"
}

function signIn(){
  if(navigator.onLine){
  var email = document.getElementById("email");
  var password = document.getElementById("password");
  const promise = auth.signInWithEmailAndPassword(email.value, password.value);
  promise.catch(e => alert('Combinazione utente/password errata'));

}else{
  document.getElementById('display').innerHTML = '<h1>Impossibile connetersi al server</h1>'
}}

function signOut(){
  auth.signOut();
  alert("Disconnessione completata!");
  window.location.reload()

}

auth.onAuthStateChanged(function(user){
   document.title = "Pagamenti Marco Express AC";
    var email = user.email;
    console.warn('Utente attivo.')

    document.getElementById("password").style.display="none";
    document.getElementById("email").style.display="none";
    document.getElementById("signIn").style.display="none";
    document.getElementById("button").style.display="none";
    document.getElementById("intro").style.display="none";
    document.getElementById("reip").style.display="none";
     rielabora();
});

function rielabora(){

      var disp = document.getElementById('display')
      disp.innerHTML = "<p class='ltext'>Gestisci i tuoi pagamenti</p>"

      var user = firebase.auth().currentUser;
      user.providerData.forEach(function (profile) {
        var soldiora = Number(profile.displayName);
        console.log(soldiora)
        var soldiarr = Math.round((soldiora + Number.EPSILON) * 100)
        var soldi = soldiarr / 100
        if(soldi >= 0){
          disp.innerHTML += "<p class='ntext'>Denaro totale prepagato memorizzato nell'account: " + "</p><p class='ltext'>&euro;"+ soldi + "</p><h2>(Il sistema arrotonda il numero per l'output)</h2>"
        }else{
          disp.innerHTML += "<p class='ntext'>Denaro totale prepagato memorizzato nell'account: " + "</p><p class='ltext red'>Attenzione! Hai dei debiti, con un importo totale da pagare di<br>&euro;"+ soldi + "</p><h2>(Il sistema arrotonda il numero per l'output)</h2>"
          console.log("Debito!")
        }

      });
      var nomespesa = localStorage.getItem("nomespesa");
      var costospesa = localStorage.getItem("costospesa");
      var statospesa = localStorage.getItem("statospesa");
      if(nomespesa === null){
        nomespesa = 'Nessuna spesa registrata di recente'
      }
      if(costospesa === null){
        costospesa = 'N/D'
      }
      if(statospesa === null){
        statospesa = 'N/D'
      }
      disp.innerHTML += "<button id='nuovop' onclick='prepagato()'><h1>Aggiungi denaro</h1></button><br><br>"
      disp.innerHTML += "<button onclick='nspesa()' id='nuovos'><h1>Nuova spesa</h1></button>"
      disp.innerHTML += "<p class='ltext'>Ultima spesa</p>"
      disp.innerHTML += "<table><tr><td><p class='ntext'><strong>Nome Spesa</strong></p></td><td><p class='ntext'><strong>Importo</strong></p></td></tr><tr><td><p class='ntext'>" + nomespesa + "</p></td><td><p class='ntext'>&euro;" + costospesa + "</p></td><td><p class='ntext'>Stato: " + statospesa + "</p></td></tr></table><br>"
      disp.innerHTML += "<br><center><button onclick='signOut()' id='signOut'><h1>Logout</h1><img src='https://lh3.googleusercontent.com/pw/ACtC-3fxEqyRV4Kgd6Zq9ZYJSi8aBG4TOp5qqBYOGl7OnRZUogm68jgxH4UIwV2rIi1pIUDv62xzfK4Cwbj_xIQyKVdqMtGtecPJa3t36jMGNe4bS_7_5h8QrdJH6lMSlc-9vmqzvKUcR5tGcj7zNqJpY_la=s24-no?authuser=0' height='50px'></button></center>"
      document.getElementById("barrastato").innerHTML = "<button onclick='rielabora()' id='ritornaacasa'><h1><span class='material-icons'>home</span> Ritorna alla home</h1></button>"
}


   function prepagato() {
var disp = document.getElementById('display')
     disp.innerHTML = "<p class='ltext'>Passaggi per la ricarica del portafoglio:</p>"
     disp.innerHTML += "<p class='ntext'>1) Imposta il numero di soldi</p>"
     disp.innerHTML += "<input type='number' id='euroc' style='width: 10%'></input><h1>&nbsp;&nbsp;&nbsp;&euro;</h1>"
     disp.innerHTML += "<p class='ntext'>2) Recati alla sede centrale Marco Express</p>"
     disp.innerHTML += "<p class='ntext'>3) Chiedi la ricarica del portafoglio ad un adetto, poi mostragli il seguente QR code</p><center><button onclick='creaq()' id='creaq' style='width:20%'><h1>Crea il QRcode</h1></button></center><canvas id='q'></canvas><br><br><br><br><br><br><button onclick='ritornadap()' id='ann'><h1>Esci</h1></button>"
    //



   }

   function creaq(){
     document.getElementById("creaq").style.display="none";
     var user = firebase.auth().currentUser;
     user.providerData.forEach(function (profile) {
      var email = profile.email
      var num = document.getElementById('euroc').value
      var testq = "Richiesta da parte di " + email + ". &euro;" + num + ". https://marco-express.github.io/marcoexpress.official.site.github.io/arearis.html"

      new QRious({element: document.getElementById("q"), value: testq, size: 300});

     });


   }

   function nspesa(){
     var disp = document.getElementById('display')
    disp.innerHTML = "<center><p class='ltext'>Nuova spesa</p></center>"
    disp.innerHTML += '<select name="nuovaspesa" id="nn" style="width: 90%"><option value="mmppu"><h1>Abbonamento Meteo Marco Premium Plus - 1 Settimana</h1></option><option value="mmppd"><h1>Abbonamento Meteo Marco Premium Plus - 2 Settimane</h1></option><option value="prmh"><h1>Pagamento rapido Marco Hairdresser</h1></option><option value="donazione"><h1>Donazione per sostenere Marco Express</h1></option></select><span id="costo"></span><span id="push"></span>'
    setTimeout('ripeti()', 100)
   }

   function ripeti() {
     var disp = document.getElementById('display')
      var tipo = document.getElementById("nn").value
      console.log(tipo)
      if(tipo==="mmppu"){
        mmppu();
      }else if(tipo==="mmppd"){
        mmppd();
      }else if(tipo === "prmh"){
        prmh();
      }else if(tipo === "donazione"){
        dona();
      }
      setTimeout('ripeti()', 500)
   }

function mmppu() {
  var user = firebase.auth().currentUser;
  user.providerData.forEach(function (profile) {
    if(profile.photoURL != ' ') {
      document.getElementById('costo').innerHTML = "<p class='ntext' style='background: red'>Hai gi&agrave; un abbonamento Meteo Marco Premium Plus Attivo.</p>"
    }else{
        document.getElementById('costo').innerHTML = "<p class='ntext'>Costo: &euro; 0,50</p>"
        document.getElementById('push').innerHTML = "<button onclick='comprammpp()' class='comprap'><h1>Acquista ora!</h1></button>"

    }

 });
}

function mmppd(){
  var user = firebase.auth().currentUser;
  user.providerData.forEach(function (profile) {
    if(profile.photoURL != ' ') {
      document.getElementById('costo').innerHTML = "<p class='ntext' style='background: red'>Hai gi&agrave; un abbonamento Meteo Marco Premium Plus Attivo.</p>"
    }else{
        document.getElementById('costo').innerHTML = "<p class='ntext'>Costo: &euro; 1,00</p>"
        document.getElementById('push').innerHTML = "<button onclick='comprammppd()' class='comprap'><h1>Acquista ora!</h1></button>"

    }

 });
}

function comprammpp() {
  var disp = document.getElementById('display')
  disp.innerHTML = "<p class='ltext'>Vuoi effettuare l'acquisto?</p><p class='ntext'>Importo: &euro; 0,50<br>Nome articolo: Meteo Marco Premium Plus<br>Durata: 1 Settimana</p>"
  disp.innerHTML += "<button id='ann' onclick='ritornadap()'><h1>Annulla</h1></button><button id='acq' onclick='mmppp()'><h1>Acquista</h1></button>"

}

function comprammppd() {
  var disp = document.getElementById('display')
  disp.innerHTML = "<p class='ltext'>Vuoi effettuare l'acquisto?</p><p class='ntext'>Importo: &euro; 1,00<br>Nome articolo: Meteo Marco Premium Plus<br>Durata: 2 Settimane</p>"
  disp.innerHTML += "<button id='ann' onclick='ritornadap()'><h1>Annulla</h1></button><button id='acq' onclick='mmppdd()'><h1>Acquista</h1></button>"

}

function prepagatommpp(){
  var user = firebase.auth().currentUser;
  user.providerData.forEach(function (profile) {
    var soldia = Number(profile.displayName)
    var soldiarr = Math.round((soldia + Number.EPSILON) * 100)
    var soldi = soldiarr / 100
    if(soldi <= 0.50){
      console.log('non hai soldi, POVERO!')
      localStorage.setItem("nomespesa", "Meteo Marco Premium Plus - 1 Settimana");
      localStorage.setItem("costospesa", "0,50");
      localStorage.setItem("statospesa", "Non eseguita: denaro insufficente");
      document.getElementById('display').innerHTML = "<p class='ltext'>Denaro insufficente</p><p class='ntext'>Sembra che nel tuo account non ci siano i soldi necessari per l'acquisto. Se vuoi ricaricare il portafoglio <a onclick='prepagato()'>CLICCA QUI</a>. "
    }else{
      var soldiad = profile.displayName
      var numsoldiad = Number(soldiad);
      var fine = numsoldiad - 0.50
      var invia = "" + fine
      console.log(typeof invia)
      user.updateProfile({
     displayName: invia
   }).then(function() {
     console.log('primo ok')
   }).catch(function(error) {
     document.write("<p class='ltext'>Errore</p><br><h1>Si &egrave; verificato un errore imprevisto. Tipo di errore: errore nel pagamento</h1>")
   });

                var d = new Date();
                orad = d.getHours();
                min = d.getMinutes();
                dataduen = d.getDate();
                mesed = d.getMonth();
                annodue = d.getFullYear();
                mesed++

                var piusett = new Date()
                piusett.setDate(dataduen + 7)
                console.log(piusett)
                var invia = ""+piusett
   user.updateProfile({
  photoURL: invia
}).then(function() {
  alert('Acquisto effettuato, ora puoi accedere ai servizi offerti da Meteo Marco Premium Plus')
  localStorage.setItem("nomespesa", "Meteo Marco Premium Plus - 1 Settimana");
  localStorage.setItem("costospesa", "0,50");
  localStorage.setItem("statospesa", "Spesa effettuata correttamente");
  ritornadap()
}).catch(function(error) {
    document.write("Errore, contatta un tecnico Marco Express. <br>Dettagli: <br> Pagamento riuscito: true <br> Memorizzazione dati nell'account: false<br>Error type: " + error)
    localStorage.setItem("nomespesa", "Meteo Marco Premium Plus - 1 Settimana");
  localStorage.setItem("costospesa", "0,50");
  localStorage.setItem("statospesa", "Spesa non effettuata causa errore");
});


    }
  });
}



function mmppp(){
  console.log("Ricezione not")
  localStorage.setItem("tipos", "mmpp");
  tipopagamento();
}
function mmppdd(){
  localStorage.setItem("tipos", "mmppdd");
  tipopagamento();
}

function addebitommppd(){
  var user = firebase.auth().currentUser;
  user.providerData.forEach(function (profile) {
    var soldiora = Number(profile.displayName);
    console.log(soldiora)
    var soldiarr = Math.round((soldiora + Number.EPSILON) * 100)
    var soldi = soldiarr / 100
    if(soldi > 1){
      document.getElementById('display').innerHTML = "<p class='ltext'>Questa cifra &egrave; pagabile con i soldi gi&agrave; memorizzati nell'account</p><p class='ntext'>Sembra che nel tuo account ci siano i soldi necessari per l'acquisto. Per effettuare il pagamento con i soldi gi&agrave; memorizzati nell'account, <a onclick='prepagatommpp()'>CLICCA QUI</a> "
    }else{
      var soldiad = profile.displayName
      var numsoldiad = Number(soldiad);
      var okkkk = numsoldiad - 1.48
      var invia = "" + okkkk
      console.log(typeof invia)
      user.updateProfile({
     displayName: invia
   }).then(function() {
     console.log('primo ok')
   }).catch(function(error) {
     document.write("<p class='ltext'>Errore</p><br><h1>Si &egrave; verificato un errore imprevisto. Tipo di errore: errore nel pagamento</h1>")
   });

                var d = new Date();
                orad = d.getHours();
                min = d.getMinutes();
                dataduen = d.getDate();
                mesed = d.getMonth();
                annodue = d.getFullYear();
                mesed++

                var piusett = new Date()
                piusett.setDate(dataduen + 14)
                console.log(piusett)
                var invia = ""+piusett
   user.updateProfile({
  photoURL: invia
}).then(function() {
  alert('Acquisto effettuato, ora puoi accedere ai servizi offerti da Meteo Marco Premium Plus')
  localStorage.setItem("nomespesa", "Meteo Marco Premium Plus - 2 Settimane");
  localStorage.setItem("costospesa", "1,00");
  localStorage.setItem("statospesa", "Spesa eseguita correttamente");
  ritornadap()
}).catch(function(error) {
    document.write("Errore, contatta un tecnico Marco Express. <br>Dettagli: <br> Pagamento riuscito: true <br> Memorizzazione dati nell'account: false<br>Error type: " + error)
    localStorage.setItem("nomespesa", "Meteo Marco Premium Plus - 2 Settimane");
    localStorage.setItem("costospesa", "1,00");
    localStorage.setItem("statospesa", "Pagamento effettuato. Memorizzazione dei dati non riuscita. Contattare un tecnico");
});


    }
  });
}

function prmh(){
  document.getElementById('costo').innerHTML = " "
  var disp = document.getElementById('display')
  disp.innerHTML = "<p class='ltext'>Pagamento rapido Marco Hairdresser</p><p class='ntext'>Inserisci importo</p><input type='number' id='prmhuno'></input><p class='ntext'>&euro;</p><button onclick='confmhp()' style='width: 30%'><h1>Conferma</h1></button>"

}

function confmhp() {
    var user = firebase.auth().currentUser;
  var importo = document.getElementById('prmhuno').value
    user.providerData.forEach(function (profile) {
    var disp = document.getElementById('display')
    disp.innerHTML = "<p class='ltext'>Effettuare il pagamento?</p><p class='ntext'>Importo: &euro;" + importo + "<br> Email mittente: " +  profile.email + "</p><br>"
    disp.innerHTML += "<button id='ann' onclick='ritornadap()'><h1>Annulla</h1></button><button id='acq' onclick='mhpsave()'><h1>Paga</h1></button>"
    localStorage.setItem("importomh", importo);
  })

}

function mhpsave(){
  localStorage.setItem("tipos", "mhp");
  tipopagamento();
}

function prepagatomhp() {
  var letcok = localStorage.getItem("importomh");
  console.log(letcok)
  localStorage.setItem("nomespesa", "Pagemento Rapido Marco Hairdresser");
  localStorage.setItem("costospesa", letcok);
  localStorage.setItem("statospesa", "Non eseguita");
  var user = firebase.auth().currentUser;
  user.providerData.forEach(function (profile) {
    var soldiora = Number(profile.displayName);
    console.log(soldiora)
    var soldiarr = Math.round((soldiora + Number.EPSILON) * 100)
    var soldi = soldiarr / 100
  var numimp = Number(letcok)
  if(soldi >= numimp){

  var sottrai = soldi - numimp
  var invia = "" + sottrai
  user.updateProfile({
 displayName: invia
}).then(function() {
 document.getElementById('display').innerHTML = "<p class='ltext'>Pagemento effettuato correttemente.</p><p class='ntext'>Se lo staff richiede il certificato di pagamento, Mostrare il seguente QR Code.</p><canvas id='qq'></canavas><br><button id='ann' onclick='ritornadap()'><h1>Annulla</h1></button>"
 var testoqr = "Pagamento effettuato. Valore: euro " + letcok + ". Da parte di " + profile.email + ". Tipo richiesta: Marco Hairdresser PagoFast" ;
 localStorage.setItem("nomespesa", "Pagemento Rapido Marco Hairdresser");
 localStorage.setItem("costospesa", letcok);
 localStorage.setItem("statospesa", "Eseguita");
   new QRious({element: document.getElementById("qq"), value: testoqr, size: 300});
}).catch(function(error) {
 document.write("<p class='ltext'>Errore</p><br><h1>Si &egrave; verificato un errore imprevisto. Tipo di errore: errore nel pagamento</h1>")
});
}else{
  document.getElementById('display').innerHTML = "<p class='ltext'>Denaro insufficente</p><p class='ntext'>Sembra che nel tuo account non ci siano i soldi necessari per la spesa. Se vuoi ricaricare il portafoglio <a onclick='prepagato()'>CLICCA QUI</a>. "
  localStorage.setItem("nomespesa", "Pagemento Rapido Marco Hairdresser");
  localStorage.setItem("costospesa", letcok);
  localStorage.setItem("statospesa", "Non eseguita: denaro insufficente");
}
})

}

function prepagatommppd() {

  localStorage.setItem("nomespesa", "Meteo Marco Premium Plus - 2 Settimane");
  localStorage.setItem("costospesa", "1,00");
  localStorage.setItem("statospesa", "Non eseguita");
  var user = firebase.auth().currentUser;
  user.providerData.forEach(function (profile) {
  var soldiad = Number(profile.displayName)
  var soldiarr = Math.round((soldiad + Number.EPSILON) * 100)
  var soldi = soldiarr / 100
  if(soldi >= 1){

  var sottrai = soldiad - 1
  var invia = "" + sottrai
  user.updateProfile({
 displayName: invia
}).then(function() {
  alert('Acquisto effettuato, ora puoi accedere ai servizi offerti da Meteo Marco Premium Plus')
  localStorage.setItem("nomespesa", "Meteo Marco Premium Plus - 2 Settimane");
  localStorage.setItem("costospesa", "1,00");
  localStorage.setItem("statospesa", "Spesa effettuata correttamente");
}).catch(function(error) {
 document.write("<p class='ltext'>Errore</p><br><h1>Si &egrave; verificato un errore imprevisto. Tipo di errore: errore nel pagamento</h1>")
 alert(error)
});
}else{
  document.getElementById('display').innerHTML = "<p class='ltext'>Denaro insufficente</p><p class='ntext'>Sembra che nel tuo account non ci siano i soldi necessari per la spesa. Se vuoi ricaricare il portafoglio <a onclick='prepagato()'>CLICCA QUI</a>. "
  localStorage.setItem("nomespesa", "Pagemento Rapido Marco Hairdresser");
  localStorage.setItem("costospesa", letcok);
  localStorage.setItem("statospesa", "Non eseguita: denaro insufficente");
}
})

var d = new Date();
orad = d.getHours();
min = d.getMinutes();
dataduen = d.getDate();
mesed = d.getMonth();
annodue = d.getFullYear();
mesed++

var piusett = new Date()
piusett.setDate(dataduen + 14)
console.log(piusett)
var invia = ""+piusett
user.updateProfile({
photoURL: invia
}).then(function() {
alert('Acquisto effettuato, ora puoi accedere ai servizi offerti da Meteo Marco Premium Plus')
localStorage.setItem("nomespesa", "Meteo Marco Premium Plus - 2 Settimane");
localStorage.setItem("costospesa", "1,00");
localStorage.setItem("statospesa", "Spesa effettuata correttamente");
ritornadap()
}).catch(function(error) {
document.write("Errore, contatta un tecnico Marco Express. <br>Dettagli: <br> Pagamento riuscito: true <br> Memorizzazione dati nell'account: false<br>Error type: " + error)
localStorage.setItem("nomespesa", "Meteo Marco Premium Plus - 2 Settimane");
localStorage.setItem("costospesa", "1,00");
localStorage.setItem("statospesa", "Spesa non effettuata causa errore");
});


}

function dona(){
  document.getElementById('costo').innerHTML = " "
  var disp = document.getElementById('display')
  disp.innerHTML = "<p class='ltext'>Dona una cifra per sostenere Marco Express</p><p class='ntext'>Inserisci importo</p><input type='number' id='donaa' style='float:left; width: 50%; height: 45px;'></input><p class='ntext'>&euro;</p><button onclick='confermadona()' style='width: 30%'><h1>Conferma</h1></button>"

}
function confermadona() {
  var user = firebase.auth().currentUser;
var importo = document.getElementById('donaa').value
  user.providerData.forEach(function (profile) {
  var disp = document.getElementById('display')
  disp.innerHTML = "<p class='ltext'>Effettuare il pagamento?</p><p class='ntext'>Importo: &euro;" + importo + "<br> Email mittente: " +  profile.email + "</p><br>"
  disp.innerHTML += "<button id='ann' onclick='ritornadap()'><h1>Annulla</h1></button><button id='acq' onclick='pagadona()'><h1>Paga</h1></button>"
  localStorage.setItem("impdona", importo);
})
}

function pagadona(){
  var letcok = localStorage.getItem("impdona");
  console.log(letcok)
  localStorage.setItem("nomespesa", "Donazione Marco Express");
  localStorage.setItem("costospesa", letcok);
  localStorage.setItem("statospesa", "Non eseguita");
  var user = firebase.auth().currentUser;
  user.providerData.forEach(function (profile) {
    var soldiora = Number(profile.displayName);
    console.log(soldiora)
    var soldiarr = Math.round((soldiora + Number.EPSILON) * 100)
    var soldi = soldiarr / 100
  var numimp = Number(letcok)
  if(soldi >= numimp){

  var sottrai = soldiad - numimp
  var invia = "" + sottrai
  user.updateProfile({
 displayName: invia
}).then(function() {
 document.getElementById('display').innerHTML = "<p class='ltext'>Donazione effettuata correttemente.</p><br><p class='ltext'>Ti ringraziamo moltissimo!<br> Noi di Marco Express creiamo questi sistemi e li mettiamo a vostra disposizione gratuitamente, utilizzando moltissimo tempo. Tu ci hai ricompensato. Ci fa piacere. Continueremo ad aggiornare i nostri siti, per fornirti un'esperienza fantastica! <br>&#x1f493; Grazie di cuore &#x1f493;</p><button id='ann' onclick='ritornadap()'><h1>Ritorna alla Home</h1></button>"
 localStorage.setItem("nomespesa", "Donazione Marco Express");
 localStorage.setItem("costospesa", letcok);
 localStorage.setItem("statospesa", "Eseguita");
}).catch(function(error) {
 document.write("<p class='ltext'>Errore</p><br><h1>Si &egrave; verificato un errore imprevisto. Tipo di errore: errore nel pagamento</h1>")
 localStorage.setItem("nomespesa", "Donazione Marco Express");
 localStorage.setItem("costospesa", letcok);
 localStorage.setItem("statospesa", "Non eseguita: errore");
});
}else{
  document.getElementById('display').innerHTML = "<p class='ltext'>Denaro insufficente</p><p class='ntext'>Sembra che nel tuo account non ci siano i soldi necessari per la spesa. Se vuoi ricaricare il portafoglio <a onclick='prepagato()'>CLICCA QUI</a>. "
  localStorage.setItem("nomespesa", "Donazione Marco Express");
  localStorage.setItem("costospesa", letcok);
  localStorage.setItem("statospesa", "Non eseguita: denaro insufficente");
}
})
}



function esci() {
  document.getElementById('display').innerHTML = "<button onclick='ritornadap()' id='acq'>Esci</button>"
}

function ritornadap(){
   rielabora()
 }

function showPwd() {
  var input = document.getElementById('password');
  if (input.type === "password") {
    input.type = "text";
  } else {
    input.type = "password";

  }
}

function alt(){
  var user = firebase.auth().currentUser;
  user.providerData.forEach(function (profile) {
    console.log(profile.displayName)
  })
}

function feed() {
  location.href = 'https://docs.google.com/forms/d/e/1FAIpQLSdtuUKjayKMK4yypsgnN0ftwQNLXYO_SGX-yTO4ocf4reLPBA/viewform?usp=sf_link'
}

function tipopagamento(){
  var disp = document.getElementById("display")
  var rigauno = "<center><button style='width: 75%; height: auto; border: 1px solid gray; border-radius: 7px; background-color: white;' onclick='prepa()' id='prepa'><p class='modpagaa'><span class='material-icons md-36 green' id='pdp'>credit_score</span> <strong>Pagamento con denaro prepagato</strong></p></button></center>"
  var rigadue = "<center><button style='width: 75%; height: auto; border: 1px solid gray; border-radius: 7px; background-color: white;' onclick='addebito()' id='debit'><p class='modpagaa'><span class='material-icons md-36 red' id='pa'>paid</span> <strong>Pagamento con addebito</strong></p></button></center>"

  disp.innerHTML = "<center><div id='selezionamod'><p class='modpaga'><strong>Seleziona la modalit&agrave; di pagamento</strong><br>Per <span id='spanimp'></span></p>" + rigauno + "<br>" + rigadue + "<br><br><br><button onclick='pagaaa()' id='pagaaaa'><h1>Paga</h1></button><br><br><br><br><p class='ntext'>La modalit&agrave; \"Pagamento con addebito\" &egrave; soggetta ad interessi. <a href='https://docs.google.com/document/d/1c3iw9YvXpmN7Hro3a1s9N3w5qUl6JYoK3AUsrSiB0ak/preview'>Ulteriori informazioni</a></p></div><center>"

  document.getElementById("pagaaaa").disabled = true;
  return true;
}

function prepa(){
  localStorage.setItem("tipodipagamento", "prepagato");
  $("#pdp").css({
    color: "black"
  })
  $("#prepa").css({
    backgroundColor: "#02d935"
  })
  $("#pa").css({
    color: "red"
  })
  $("#debit").css({
    backgroundColor: "white"
  })

  var tiposp = localStorage.getItem("tipos");
  var mhimp= localStorage.getItem("importomh");
  var costo
  if(tiposp === "mmpp"){
    costo = "<p class='ltext'>&euro; 0,50</p>"
  }else if(tiposp === "mmppdd"){
    costo = "<p class='ltext'>&euro; 1,00</p>"
  }else if(tiposp === "mhp"){
    costo = "<p class='ltext'>&euro; " + mhimp + "</p>"
  }
  document.getElementById("spanimp").innerHTML = costo
  document.getElementById("pagaaaa").disabled = false;
  return false;
}
function addebito(){
    localStorage.setItem("tipodipagamento", "addebito");
  $("#pa").css({
    color: "black"
  })
  $("#debit").css({
    backgroundColor: "red"
  })
  $("#pdp").css({
    color: "#02d93"
  })
  $("#prepa").css({
    backgroundColor: "white"
  })


  var tiposp = localStorage.getItem("tipos");
  var mhimpp= localStorage.getItem("importomh");
  var mhimp= Number(mhimpp)
  var costo
  if(tiposp === "mmpp"){
    var importo = 0.50 * 45
    var importouno = importo / 100
    var impfin = importouno + 0.50
    var imp = Number(impfin)
    var ok = imp * 2
    var okk = ok / 100
    var ultimo = imp + okk
    var soldiarr = Math.round((ultimo + Number.EPSILON) * 100)
    var soldi = soldiarr / 100
    costo = "<p class='ltext'>&euro; " + soldi + "</p>"
  }else if(tiposp === "mmppdd"){
    var importo = 1 * 45
    var importouno = importo / 100
    var impfin = importouno + 1
    var imp = Number(impfin)
    var ok = imp * 2
    var okk = ok / 100
    var ultimo = imp + okk
    var soldiarr = Math.round((ultimo + Number.EPSILON) * 100)
    var soldi = soldiarr / 100
    costo = "<p class='ltext'>&euro; " + soldi + "</p>"
  }else if(tiposp === "mhp"){
    var importo = mhimp * 45
    var importouno = importo / 100
    var impfin = importouno + mhimp
    var imp = Number(impfin)
    var ok = imp * 2
    var okk = ok / 100
    var ultimo = imp + okk
    var soldiarr = Math.round((ultimo + Number.EPSILON) * 100)
    var soldi = soldiarr / 100
    costo = "<p class='ntext'>Richiesti &euro; " + localStorage.getItem("importomh") + " </p><p class='ltext'>&euro; " + soldi + "</p>"
  }
  document.getElementById("spanimp").innerHTML = costo
  document.getElementById("pagaaaa").disabled = false;
  return false;
}

function pagaaa(){
  var tipopa = localStorage.getItem("tipodipagamento");
  if(tipopa === "prepagato"){
    var tiposp = localStorage.getItem("tipos");
    console.log(tiposp)
    if(tiposp === "mmpp"){
      //abbonamento prepagato a Meteo Marco, una settimana
      prepagatommpp();
    }else if(tiposp === "mmppdd"){
      //abbonamento prepagato a Meteo Marco, due settimane
      prepagatommppd();
    }else if(tiposp === "mhp"){
      prepagatomhp();
    }
  }
  if(tipopa === "addebito"){
    var tiposp = localStorage.getItem("tipos");
    if(tiposp === "mmpp"){
      console.log("mmpp")
      addebitommpp();
    }else if(tiposp === "mmppdd"){
      addebitommppd();
    }else if(tiposp === "mhp"){
      addebitomhp();
    }
  }
}


function addebitommpp(){
  console.log("AAA")
  var user = firebase.auth().currentUser;
  user.providerData.forEach(function (profile) {
    var soldiora = Number(profile.displayName);
    console.log(soldiora)
    var soldiarr = Math.round((soldiora + Number.EPSILON) * 100)
    var soldi = soldiarr / 100
    console.log(soldiora)
    var soldiarr = Math.round((soldiora + Number.EPSILON) * 100)
    var soldi = soldiarr / 100
    if(soldi > 0.5){
        console.log("0")
      document.getElementById('display').innerHTML = "<p class='ltext'>Questa cifra &egrave; pagabile con i soldi gi&agrave; memorizzati nell'account</p><p class='ntext'>Sembra che nel tuo account ci siano i soldi necessari per l'acquisto. Per effettuare il pagamento con i soldi gi&agrave; memorizzati nell'account, <a onclick='prepagatommpp()'>CLICCA QUI</a> "
    }else{
      var soldiad = profile.displayName
      var numsoldiad = Number(soldiad);
      var importo = 0.50 * 45
      var importouno = importo / 100
      var impfin = importouno + 0.50

      var imp = Number(impfin)
      var ok = imp * 2
      var okk = ok / 100
      var ultimo = imp + okk

      var fine = numsoldiad - ultimo
      var invia = "" + fine
      console.log(typeof invia)
      user.updateProfile({
     displayName: invia
   }).then(function() {
     console.log('primo ok')
   }).catch(function(error) {
     document.write("<p class='ltext'>Errore</p><br><h1>Si &egrave; verificato un errore imprevisto. Tipo di errore: errore nel pagamento</h1>")
   });

                var d = new Date();
                orad = d.getHours();
                min = d.getMinutes();
                dataduen = d.getDate();
                mesed = d.getMonth();
                annodue = d.getFullYear();
                mesed++

                var piusett = new Date()
                piusett.setDate(dataduen + 7)
                console.log(piusett)
                var invia = ""+piusett
   user.updateProfile({
  photoURL: invia
}).then(function() {
  alert('Acquisto effettuato, ora puoi accedere ai servizi offerti da Meteo Marco Premium Plus')
  localStorage.setItem("nomespesa", "Meteo Marco Premium Plus - 1 Settimana");
  localStorage.setItem("costospesa", "0,50");
  localStorage.setItem("statospesa", "Spesa effettuata correttamente");
  ritornadap()
}).catch(function(error) {
    document.write("Errore, contatta un tecnico Marco Express. <br>Dettagli: <br> Pagamento riuscito: true <br> Memorizzazione dati nell'account: false<br>Error type: " + error)
    localStorage.setItem("nomespesa", "Meteo Marco Premium Plus - 1 Settimana");
  localStorage.setItem("costospesa", "0,50");
  localStorage.setItem("statospesa", "Spesa non effettuata causa errore");
});


    }
  });
}

function addebitomhp(){
  var letcok = localStorage.getItem("importomh");
  var numerosoldi = Number(letcok);
  console.log(letcok)
  localStorage.setItem("nomespesa", "Pagemento Rapido Marco Hairdresser");
  localStorage.setItem("costospesa", letcok);
  localStorage.setItem("statospesa", "Non eseguita");
  var user = firebase.auth().currentUser;
  user.providerData.forEach(function (profile) {
    var soldiora = Number(profile.displayName);
    console.log(soldiora)
    var soldiarr = Math.round((soldiora + Number.EPSILON) * 100)
    var soldi = soldiarr / 100
  var numimp = Number(letcok)
  if(profile.displayName >= soldi){
    document.getElementById('display').innerHTML = "<p class='ltext'>Questa cifra &egrave; pagabile con i soldi gi&agrave; memorizzati nell'account</p><p class='ntext'>Sembra che nel tuo account ci siano i soldi necessari per l'acquisto. Per effettuare il pagamento con i soldi gi&agrave; memorizzati nell'account, <a onclick='prepagatommpp()'>CLICCA QUI</a> "
  }else{
    var soldiad = profile.displayName
    var numsoldiad = Number(soldiad);

    var importo = numerosoldi * 45
    var importouno = importo / 100
    var impfin = importouno + numerosoldi
    var imp = Number(impfin)

    var ok = imp * 2
    var okk = ok / 100
    var ultimo = imp + okk
    var fine = numsoldiad - ultimo
    var invia = "" + fine
    console.log(invia)
  user.updateProfile({
 displayName: invia
}).then(function() {
 document.getElementById('display').innerHTML = "<p class='ltext'>Pagemento effettuato correttemente.</p><p class='ntext'>Se lo staff richiede il certificato di pagamento, Mostrare il seguente QR Code.</p><canvas id='qq'></canavas><br><button id='ann' onclick='ritornadap()'><h1>Annulla</h1></button>"
 var testoqr = "Pagamento effettuato. Valore: euro " + letcok + ". Da parte di " + profile.email + ". Tipo richiesta: Marco Hairdresser PagoFast" ;
 localStorage.setItem("nomespesa", "Pagemento Rapido Marco Hairdresser");
 localStorage.setItem("costospesa", letcok);
 localStorage.setItem("statospesa", "Eseguita");
   new QRious({element: document.getElementById("qq"), value: testoqr, size: 300});
}).catch(function(error) {
 document.write("<p class='ltext'>Errore</p><br><h1>Si &egrave; verificato un errore imprevisto. Tipo di errore: errore nel pagamento</h1>")
});
}

})
}

</script>


<style>
.material-icons.md-18 { font-size: 18px; }
.material-icons.md-24 { font-size: 24px; }
.material-icons.md-36 { font-size: 36px; }
.material-icons.md-48 { font-size: 48px; }
.material-icons.md-150 { font-size: 150px; }
.material-icons.red { color: red; }
.material-icons.green { color: #02d935; }
button{
  cursor: pointer;
}
#selezionamod{
  width: 75%;
  height: 45%;
  border: 1px solid gray;
  border-radius: 15px;

}
.modpaga{
    font-family: 'Roboto', sans-serif;
    font-size: 40px;
}
.modpagaa{
    font-family: 'Roboto', sans-serif;
    font-size: 35px;
  }
#signOut {
  height: 25%;
  background: #f0cccc;
  width: 38%;
  border: 3px solid red;
  letter-spacing: 2px;
  border-radius: 15px;
  box-shadow: 10px 10px 5px #dedede;
}
#signIn {
  background: #b2f7bc;
  width: 200px;
  border: 3px solid #0af52c;
  letter-spacing: 2px;
  border-radius: 40px;
}
#pagaaaa{
  background: #b2f7bc;
  width: 200px;
  border: 3px solid #0af52c;
  letter-spacing: 2px;
  border-radius: 40px;
}

#ann {
  background: #ff4040;
  width: 200px;
  border: 3px solid #db0700;
  letter-spacing: 2px;
  border-radius: 40px;
  float:left;
}
#acq {
  background: #b2f7bc;
  width: 200px;
  border: 3px solid #0af52c;
  letter-spacing: 2px;
  border-radius: 40px;
  float: right;
}
#password,#email {
  width:80%;
  background: #d5dbd6;
  border: 3px solid black;
  font-size: 250%;
  border-radius: 20px;
  box-shadow: 15px 10px 5px #dedede;

}
#euroc{
  font-size: 25px;
  border: 2px solid black;
  float: left;
}
.ltext{
  font-family: 'Lato', sans-serif;
  font-size: 50px
}
.ltext.red{
  font-family: 'Lato', sans-serif;
  font-size: 50px;
  color: red;
}
.ntext{
  font-family: 'Lato', sans-serif;
  font-size: 35px
}
#nn{
  font-size: 30px;
  border-radius: 5px;
  background-color: #cfd3d4;
}
.comprap{
  border: 3px solid #0af52c;
  background: #b2f7bc;
  width: 20%;
  height: 75px;
  border-radius: 20px;
}

#nuovop{
  width: 60%;
  background-color: #4de34b;
  background-image: url("uno.png");
  background-repeat: no-repeat;
  background-position: left;
  background-size: contain;
  border-radius: 20px;
  border: 3px solid #03ff00;
}

#nuovos{
  width: 60%;
  background-color: #eb5b5b;
  background-image: url("spesa.png");
  background-repeat: no-repeat;
  background-position: left;
  background-size: contain;
  border-radius: 20px;
  border: 3px solid #d10000;
}

#prmhuno{
  float: left;
  width: 50%;
  height: 45px;
}
table {
border-collapse:collapse
}
td, th {
border:1px solid #ddd;
padding:8px;
}

#feed{
  position: fixed;
  bottom: 10px;
  height: 50px;
  width: 300px;
  border-radius: 25px;
  right: 5px;
}
#signOut {
  height: 25%;
  background: #f0cccc;
  width: 38%;
  border: 3px solid red;
  letter-spacing: 2px;
  border-radius: 15px;
  box-shadow: 10px 10px 5px #dedede;
}
#ritornaacasa{
  letter-spacing: 2px;
  background-color: #fc9292;
  border: 2px solid red;
  border-radius: 30px;
}
#barrastato{
  position: fixed;
  bottom: 10px;
  left: 5px;
}
#loading_screen{
  position: absolute;
  top:5%;
  right:5%;
  height: 90%;
  width: 90%;
  background-color: #fcc0c0;
  border: 3px solid red;
  border-radius: 10px;

}

</style>

</body>
</html>
